<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MKA Internal Media Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700,900' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">
    <!-- Animate.css -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="/css/icomoon.css">
    <!-- Simple Line Icons -->
    <link rel="stylesheet" href="/css/simple-line-icons.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- DataTables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.2/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" />
    <!--Chosen Dropdown-->
    <link rel="stylesheet" href="/css/chosen.min.css" />
    <!-- Modernizr JS -->
    <script src="/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <div id="fh5co-page">
        <header id="fh5co-header" role="banner">
            <div class="container">
                <div class="header-inner" id="menu"></div>
            </div>
        </header>
        <div id="fh5co-contact-section" class="contact-section">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-md-offset-3 text-center fh5co-heading">
                        <h2 class="inline-block">Ownership Change - X-Ray</h2>
                    </div>
                </div>
                <div class="text-center margin-top-0">
                    <!--Media Type-->
                    <div class="row input-row">
                        <div id="divMediaType" class="col-md-3 text-align-left">
                            <label for="ddlMediaType">Media Type</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <select id="ddlMediaType" class="field-width-325" onchange="getMarketList(); getOwnerList();"></select>
                        </div>
                    </div>
                    <!--Market-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="ddlMarket">Market</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <select id="ddlMarket" class="mkaRequired field-width-325" errorMessage="You must select a market." onchange="marketChanged = true; getOwnerList();"></select>
                        </div>
                    </div>
                    <!--Old Ownership-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="ddlOldOwnership">Old Ownership</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <select id="ddlOldOwnership" class="mkaRequired field-width-325" errorMessage="You must select an old ownership." onchange="oldOwnerChanged = true; getDetails();"></select>
                        </div>
                    </div>
                    <!--New Ownership-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="ddlNewOwnership">New Ownership</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <select id="ddlNewOwnership" class="mkaRequired field-width-325" errorMessage="You must select a new ownership." onchange="newOwnerChanged = true; getMarketList();"></select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h3>Old owner's active stations</h3>
                        <table id="dtOldStations" class="stripe oldOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn text-align-right">Station ID</th>
                                    <th class="exportColumn">Name</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th class="text-align-right">Station ID</th>
                                    <th>Name</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h3>New owner's active stations</h3>
                        <table id="dtNewStations" class="stripe newOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn text-align-right">Station ID</th>
                                    <th class="exportColumn">Name</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th class="text-align-right">Station ID</th>
                                    <th>Name</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h3>Old owner's active users</h3>
                        <table id="dtOldUsers" class="stripe oldOwnerDetails" style="font-size: smaller;">
                            <thead>
                                <tr>
                                    <th class="exportColumn">Name</th>
                                    <th class="exportColumn">E-mail</th>
                                    <th class="exportColumn">Contact</th>
                                    <th class="exportColumn">Recipient</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>Name</th>
                                    <th>E-mail</th>
                                    <th>Contact</th>
                                    <th>Recipient</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h3>New owner's active users</h3>
                        <table id="dtNewUsers" class="stripe newOwnerDetails" style="font-size: smaller;">
                            <thead>
                                <tr>
                                    <th class="exportColumn">Name</th>
                                    <th class="exportColumn">E-mail</th>
                                    <th class="exportColumn">Contact</th>
                                    <th class="exportColumn">Recipient</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>Name</th>
                                    <th>E-mail</th>
                                    <th>Contact</th>
                                    <th>Recipient</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h3>Old owner's active AEs / rep offices</h3>
                        <table id="dtOldAEs" class="stripe oldOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn">Name</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>Name</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h3>New owner's active AEs / rep offices</h3>
                        <table id="dtNewAEs" class="stripe newOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn">Name</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>Name</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-align-center">
                        <h3>Old owner's user station roles</h3>
                        <table id="dtOldUserStationRoles" class="stripe oldOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn text-align-right">Personnel ID</th>
                                    <th class="exportColumn">Email</th>
                                    <th class="exportColumn text-align-right">Station ID</th>
                                    <th class="exportColumn">Station</th>
                                    <th class="exportColumn">Report / Access</th>
                                    <th class="exportColumn">Manager</th>
                                    <th class="exportColumn">Contact</th>
                                    <th class="exportColumn">Submitter</th>
                                    <th class="exportColumn">Personnel Linked to Owner</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th class="text-align-right">Personnel ID</th>
                                    <th>Email</th>
                                    <th class="text-align-right">Station ID</th>
                                    <th>Station</th>
                                    <th>Report / Access</th>
                                    <th>Manager</th>
                                    <th>Contact</th>
                                    <th>Submitter</th>
                                    <th>Personnel Linked to Owner</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-align-center">
                        <h3>New owner's user station roles</h3>
                        <table id="dtNewUserStationRoles" class="stripe newOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn text-align-right">Personnel ID</th>
                                    <th class="exportColumn">Email</th>
                                    <th class="exportColumn text-align-right">Station ID</th>
                                    <th class="exportColumn">Station</th>
                                    <th class="exportColumn">Report / Access</th>
                                    <th class="exportColumn">Manager</th>
                                    <th class="exportColumn">Contact</th>
                                    <th class="exportColumn">Submitter</th>
                                    <th class="exportColumn">Personnel Linked to Owner</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th class="text-align-right">Personnel ID</th>
                                    <th>Email</th>
                                    <th class="text-align-right">Station ID</th>
                                    <th>Station</th>
                                    <th>Report / Access</th>
                                    <th>Manager</th>
                                    <th>Contact</th>
                                    <th>Submitter</th>
                                    <th>Personnel Linked to Owner</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-align-center">
                        <h3>Old owner's user to AE / rep office links</h3>
                        <table id="dtOldUserAELinks" class="stripe oldOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn">User Name</th>
                                    <th class="exportColumn">E-mail</th>
                                    <th class="exportColumn">User Linked to Owner</th>
                                    <th class="exportColumn">User Active</th>
                                    <th class="exportColumn">Contact</th>
                                    <th class="exportColumn">Recipient</th>
                                    <th class="exportColumn">AE Name</th>
                                    <th class="exportColumn">AE Linked to Owner</th>
                                    <th class="exportColumn">AE Active</th>
                                    <th class="exportColumn">User/AE Relationship</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>User Name</th>
                                    <th>E-mail</th>
                                    <th>User Linked to Owner</th>
                                    <th>User Active</th>
                                    <th>Contact</th>
                                    <th>Recipient</th>
                                    <th>AE Name</th>
                                    <th>AE Linked to Owner</th>
                                    <th>AE Active</th>
                                    <th>User/AE Relationship</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-align-center">
                        <h3>New owner's user to AE / rep office links</h3>
                        <table id="dtNewUserAELinks" class="stripe newOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn">User Name</th>
                                    <th class="exportColumn">E-mail</th>
                                    <th class="exportColumn">User Linked to Owner</th>
                                    <th class="exportColumn">User Active</th>
                                    <th class="exportColumn">Contact</th>
                                    <th class="exportColumn">Recipient</th>
                                    <th class="exportColumn">AE Name</th>
                                    <th class="exportColumn">AE Linked to Owner</th>
                                    <th class="exportColumn">AE Active</th>
                                    <th class="exportColumn">User/AE Relationship</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>User Name</th>
                                    <th>E-mail</th>
                                    <th>User Linked to Owner</th>
                                    <th>User Active</th>
                                    <th>Contact</th>
                                    <th>Recipient</th>
                                    <th>AE Name</th>
                                    <th>AE Linked to Owner</th>
                                    <th>AE Active</th>
                                    <th>User/AE Relationship</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-align-center">
                        <h3>Old owner's AE / rep office assignments</h3>
                        <table id="dtOldAEAssignments" class="stripe oldOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn">AE Name</th>
                                    <th class="exportColumn">AE Linked to Owner</th>
                                    <th class="exportColumn">AE Active</th>
                                    <th class="exportColumn text-align-right">Station ID</th>
                                    <th class="exportColumn">Station Name</th>
                                    <th class="exportColumn">Station Linked to Owner</th>
                                    <th class="exportColumn">Station Active</th>
                                    <th class="exportColumn">Advertiser Name</th>
                                    <th class="exportColumn">Agency Name</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>AE Name</th>
                                    <th>AE Linked to Owner</th>
                                    <th>AE Active</th>
                                    <th class="text-align-right">Station ID</th>
                                    <th>Station Name</th>
                                    <th>Station Linked to Owner</th>
                                    <th>Station Active</th>
                                    <th>Advertiser Name</th>
                                    <th>Agency Name</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 text-align-center">
                        <h3>New owner's AE / rep office assignments</h3>
                        <table id="dtNewAEAssignments" class="stripe newOwnerDetails">
                            <thead>
                                <tr>
                                    <th class="exportColumn">AE Name</th>
                                    <th class="exportColumn">AE Linked to Owner</th>
                                    <th class="exportColumn">AE Active</th>
                                    <th class="exportColumn text-align-right">Station ID</th>
                                    <th class="exportColumn">Station Name</th>
                                    <th class="exportColumn">Station Linked to Owner</th>
                                    <th class="exportColumn">Station Active</th>
                                    <th class="exportColumn">Advertiser Name</th>
                                    <th class="exportColumn">Agency Name</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>AE Name</th>
                                    <th>AE Linked to Owner</th>
                                    <th>AE Active</th>
                                    <th class="text-align-right">Station ID</th>
                                    <th>Station Name</th>
                                    <th>Station Linked to Owner</th>
                                    <th>Station Active</th>
                                    <th>Advertiser Name</th>
                                    <th>Agency Name</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jQuery -->
    <script src="/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!-- Waypoints -->
    <script src="/js/jquery.waypoints.min.js"></script>
    <!-- BlockUI JS -->
    <script src="/js/blockUI.js"></script>
    <!-- Config JS -->
    <script src="/js/config.js"></script>
    <!-- MAIN JS -->
    <script src="/js/main.js"></script>
    <!-- DataTables JS -->
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <!--Chosen Dropdown-->
    <script src="/js/chosen.jquery.min.js"></script>


</body>
</html>
<script>

    var gotMarkets = false;
    var gotOwners = false;

    var marketsRefreshed = false;
    var ownersRefreshed = false;

    var marketChanged = true;
    var oldOwnerChanged = true;
    var newOwnerChanged = true;

    $(document).ready(function () {
        buildMainMenu("Stations");
        $(".oldOwnerDetails").hide();
        $(".newOwnerDetails").hide();
        getMediaTypeList();
    });

    function getMediaTypeList() {

        var url = ServicePrefix + '/api/MediaType/GetMediaTypeList';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getMediaTypeListSuccess(data, textStatus, jQxhr);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);
    }

    function getMediaTypeListSuccess(data, textStatus, jQxhr) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var str = '';
        str = '<option value="-1">-- Select a Media Type</option>';
        $.each(data.report.rows, function (index) {
            str = str + '<option value="' + data.report.rows[index].MediaTypeID + '">' + data.report.rows[index].MediaTypeName + '</option>';

        });
        $("#ddlMediaType").html(str);
        convertToChosenSelect("ddlMediaType", false, false);

        getMarketList();
        getOwnerList();

    }

    function getMarketList() {

        marketsRefreshed = false;

        var mediaTypeId = $("#ddlMediaType").val();
        //if (mediaTypeId <= 0) {
        //    return;
        //}

        var url = ServicePrefix + '/api/Market/GetMarketListByProduct';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMediaTypeId": mediaTypeId,
                "inProductId": "XRY"
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getMarketListSuccess(data, textStatus, jQxhr);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);
    }


    function getMarketListSuccess(data, textStatus, jQxhr) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var previousMarketId = gotMarkets ? $("#ddlMarket").val() : -1;

        var str = '';
        str = '<option value="-1">-- Select a Market</option>';
        $.each(data.report.rows, function (index) {
            str = str + '<option value="' + data.report.rows[index].marketId + '">' + data.report.rows[index].marketName + '</option>';

        });
        $("#ddlMarket").html(str);
        convertToChosenSelect("ddlMarket", false, false);

        var previousMarketIdStillInList = false;
        $("#ddlMarket option").each(function () {
            if (this.value == previousMarketId) {
                previousMarketIdStillInList = true;
                return false;
            }
        });
        if (!previousMarketIdStillInList) {
            marketChanged = true;
        }
        $("#ddlMarket").val(previousMarketIdStillInList ? previousMarketId : -1);

        marketsRefreshed = true;
        gotMarkets = true;
        getDetails();

    }

    function getOwnerList() {

        ownersRefreshed = false;

        var mediaTypeId = $("#ddlMediaType").val();
        //if (mediaTypeId <= 0) {
        //    return;
        //}

        var marketId = gotMarkets ? $("#ddlMarket").val() : -1;
        if (marketId == -1) {
            return;
        }

        var url = ServicePrefix + '/api/Owner/GetOwnerListByProductMarket';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMediaTypeId": mediaTypeId,
                "inMarketId": marketId,
                "inProductId": "XRY"
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getOwnerListSuccess(data, textStatus, jQxhr);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function getOwnerListSuccess(data, textStatus, jQxhr) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var previousOldOwnerId = gotOwners ? $("#ddlOldOwnership").val() : -1;
        var previousNewOwnerId = gotOwners ? $("#ddlNewOwnership").val() : -1;

        var str = '';
        str = '<option value="-1">-- Select an Ownership</option>';
        $.each(data.report.rows, function (index) {
            // lowercase is intentional, that's what this API/SP returns
            str = str + '<option value="' + data.report.rows[index].ownerid + '">' + data.report.rows[index].ownername + '</option>';
        });

        $("#ddlOldOwnership").html(str);
        convertToChosenSelect("ddlOldOwnership", false, false);

        $("#ddlNewOwnership").html(str);
        convertToChosenSelect("ddlNewOwnership", false, false);

        var previousOldOwnerIdStillInList = false;
        $("#ddlOldOwnership option").each(function () {
            if (this.value == previousOldOwnerId) {
                previousOldOwnerIdStillInList = true;
                return false;
            }
        });
        if (!previousOldOwnerIdStillInList) {
            oldOwnerChanged = true;
        }
        $("#ddlOldOwnership").val(previousOldOwnerIdStillInList ? previousOldOwnerId : -1);

        var previousNewOwnerIdStillInList = false;
        $("#ddlNewOwnership option").each(function () {
            if (this.value == previousNewOwnerId) {
                previousNewOwnerIdStillInList = true;
                return false;
            }
        });
        if (!previousNewOwnerIdStillInList) {
            newOwnerChanged = true;
        }
        $("#ddlNewOwnership").val(previousNewOwnerIdStillInList ? previousNewOwnerId : -1);

        gotOwners = true;
        ownersRefreshed = true;
        getDetails();

    }

    function getDetails() {

        if (marketsRefreshed == false || ownersRefreshed == false)
        {
            return;
        }

        if ($("#ddlMarket").val() == -1)
        {
            $(".oldOwnerDetails").hide();
            $(".newOwnerDetails").hide();
            return;
        }

        var oldOwnerId = $("#ddlOldOwnership").val();
        if (oldOwnerId == -1) {
            $(".oldOwnerDetails").hide();
        } else {
            $(".oldOwnerDetails").show();
        }

        var newOwnerId = $("#ddlNewOwnership").val();
        if (newOwnerId == -1) {
            $(".newOwnerDetails").hide();
        } else {
            $(".newOwnerDetails").show();
        }

        if (oldOwnerId == -1 && newOwnerId == -1) {
            return;
        }

        var oldOrNew;
        if ((marketChanged || oldOwnerChanged) && oldOwnerId != -1) {
            oldOrNew = "Old";
            getStations(oldOrNew);
            getUsers(oldOrNew);
            getAEs(oldOrNew);
            getUserStationRoles(oldOrNew);
            getUserAELinks(oldOrNew);
            getAEAssignments(oldOrNew);
        }
        if ((marketChanged || newOwnerChanged) && newOwnerId != -1) {
            oldOrNew = "New";
            getStations(oldOrNew);
            getUsers(oldOrNew);
            getAEs(oldOrNew);
            getUserStationRoles(oldOrNew);
            getUserAELinks(oldOrNew);
            getAEAssignments(oldOrNew);
        }

    }

    function getStations(oldOrNew) {

        var marketId = $("#ddlMarket").val();
        var ownerId = $("#ddl" + oldOrNew + "Ownership").val();

        var url = ServicePrefix + '/api/Station/GetStationListByProductMarketOwner';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMarketId": marketId,
                "inOwnerId": ownerId,
                "inProductId": "XRY"
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getStationsSuccess(data, textStatus, jQxhr, oldOrNew);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function getStationsSuccess(data, textStatus, jQxhr, oldOrNew) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var stationsTableId = "dt" + oldOrNew + "Stations";

        $("#" + stationsTableId).DataTable({
            "destroy": true,
            "dom": "Blfrtip",
            "pageLength": 10,
            "columns": [
                { "data": 'stationId' },
                { "data": 'name' }
            ],
            "columnDefs": [
                {
                    "targets": [
                        0 // stationId
                    ],
                    "className": "text-align-right"
                }
            ],
            "pagingType": "full_numbers",
            "buttons": [],
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
        populateDataTable(stationsTableId, data);

    }

    function getUsers(oldOrNew) {

        var marketId = $("#ddlMarket").val();
        var ownerId = $("#ddl" + oldOrNew + "Ownership").val();

        var url = ServicePrefix + '/api/Personnel/GetPersonnelListByProductMarketOwner';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMarketId": marketId,
                "inOwnerId": ownerId,
                "inProductId": "XRY"
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getUsersSuccess(data, textStatus, jQxhr, oldOrNew);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function getUsersSuccess(data, textStatus, jQxhr, oldOrNew) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var usersTableId = "dt" + oldOrNew + "Users";

        $("#" + usersTableId).DataTable({
            "destroy": true,
            "dom": "Blfrtip",
            "pageLength": 10,
            "columns": [
                { "data": 'name' },
                { "data": 'emailAddress' },
                { "data": 'isContact' },
                { "data": 'isRecipient' }
            ],
            "pagingType": "full_numbers",
            "buttons": [],
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
        populateDataTable(usersTableId, data);

    }

    function getAEs(oldOrNew) {

        var marketId = $("#ddlMarket").val();
        var ownerId = $("#ddl" + oldOrNew + "Ownership").val();

        var url = ServicePrefix + '/api/XRAY/GetAEListByMarketOwner';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMarketId": marketId,
                "inOwnerId": ownerId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getAEsSuccess(data, textStatus, jQxhr, oldOrNew);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function getAEsSuccess(data, textStatus, jQxhr, oldOrNew) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var aesTableId = "dt" + oldOrNew + "AEs";

        $("#" + aesTableId).DataTable({
            "destroy": true,
            "dom": "Blfrtip",
            "pageLength": 10,
            "columns": [
                { "data": 'name' }
            ],
            "pagingType": "full_numbers",
            "buttons": [],
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
        populateDataTable(aesTableId, data);

    }

    function getUserStationRoles(oldOrNew) {

        var marketId = $("#ddlMarket").val();
        var ownerId = $("#ddl" + oldOrNew + "Ownership").val();

        var url = ServicePrefix + '/api/Personnel/GetPersonnelAssignmentListByMarketOwner';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMarketId": marketId,
                "inOwnerId": ownerId,
                "inProductId": "XRY"
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getUserStationRolesSuccess(data, textStatus, jQxhr, oldOrNew);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function getUserStationRolesSuccess(data, textStatus, jQxhr, oldOrNew) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var userStationRolesTableId = "dt" + oldOrNew + "UserStationRoles";

        $("#" + userStationRolesTableId).DataTable({
            "destroy": true,
            "dom": "Blfrtip",
            "pageLength": 10,
            "columns": [
                { "data": 'PersonnelId' },
                { "data": 'Email' },
                { "data": 'StationId' },
                { "data": 'Station' },
                { "data": 'Report/Access' },
                { "data": 'Manager' },
                { "data": 'Contact' },
                { "data": 'Submitter' },
                { "data": 'PersonnelLinkedToOwner' }
            ],
            "columnDefs": [
                {
                    "targets": [
                        0, // PersonnelId
                        2 // StationId
                    ],
                    "className": "text-align-right"
                }
            ],
            "pagingType": "full_numbers",
            "buttons": [],
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
        populateDataTable(userStationRolesTableId, data);

    }

    function getUserAELinks(oldOrNew) {

        var marketId = $("#ddlMarket").val();
        var ownerId = $("#ddl" + oldOrNew + "Ownership").val();

        var url = ServicePrefix + '/api/XRAY/GetUserAEListByMarketOwner';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMarketId": marketId,
                "inOwnerId": ownerId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getUserAELinksSuccess(data, textStatus, jQxhr, oldOrNew);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function getUserAELinksSuccess(data, textStatus, jQxhr, oldOrNew) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var userAELinksTableId = "dt" + oldOrNew + "UserAELinks";

        $("#" + userAELinksTableId).DataTable({
            "destroy": true,
            "dom": "Blfrtip",
            "pageLength": 10,
            "columns": [
                { "data": 'userName' },
                { "data": 'emailAddress' },
                { "data": 'userIsLinkedToOwner' },
                { "data": 'userIsActive' },
                { "data": 'userIsContact' },
                { "data": 'userIsRecipient' },
                { "data": 'aeName' },
                { "data": 'aeIsLinkedToOwner' },
                { "data": 'aeIsActive' },
                { "data": 'userAeRelationship' }
            ],
            "pagingType": "full_numbers",
            "buttons": [],
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
        populateDataTable(userAELinksTableId, data);

    }

    function getAEAssignments(oldOrNew) {

        var marketId = $("#ddlMarket").val();
        var ownerId = $("#ddl" + oldOrNew + "Ownership").val();

        var url = ServicePrefix + '/api/XRAY/GetAEAssignmentsByMarketOwner';

        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inMarketId": marketId,
                "inOwnerId": ownerId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                getAEAssignmentsSuccess(data, textStatus, jQxhr, oldOrNew);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function getAEAssignmentsSuccess(data, textStatus, jQxhr, oldOrNew) {

        if (data.response.status != "SUCCESS") {
            MKAErrorMessageRtn(data.response.errorMessage[0]);
            return;
        }

        var aeAssignmentsTableId = "dt" + oldOrNew + "AEAssignments";

        $("#" + aeAssignmentsTableId).DataTable({
            "destroy": true,
            "dom": "Blfrtip",
            "pageLength": 10,
            "columns": [
                { "data": 'aeName' },
                { "data": 'aeIsLinkedToOwner' },
                { "data": 'aeIsActive' },
                { "data": 'stationId' },
                { "data": 'stationName' },
                { "data": 'stationIsLinkedToOwner' },
                { "data": 'stationIsActive' },
                { "data": 'advertiserName' },
                { "data": 'agencyName' }
            ],
            "columnDefs": [
                {
                    "targets": [
                        4 // stationId
                    ],
                    "className": "text-align-right"
                }
            ],
            "pagingType": "full_numbers",
            "buttons": [],
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
        populateDataTable(aeAssignmentsTableId, data);

    }

</script>
