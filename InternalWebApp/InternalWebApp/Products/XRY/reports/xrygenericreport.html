<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MKA Internal Media Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700,900' rel='stylesheet' type='text/css'>

    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="/css/icomoon.css">
    <!-- Simple Line Icons -->
    <link rel="stylesheet" href="/css/simple-line-icons.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.2/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- CSS for the Chosen dropdown -->
    <link rel="stylesheet" href="/css/chosen.min.css" />

    <!-- Modernizr JS -->
    <script src="/js/modernizr-2.6.2.min.js"></script>

    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->

    <style>

        table 
        {
            border-left: solid 1px #566573!important;
            border-bottom: solid 1px #566573!important;
                                    
        }

        th
        {            
 
            /*border-bottom: solid 1px black!important;*/
            border-right: solid 1px black!important;
            color:white!important;
            background-color:#566573!important;
            border-top: solid 1px black!important;
        }
        td
        {
            border-right: solid 1px #566573!important;
            border-top: solid 1px #566573!important;
        }

        .rptView {
            margin-left: 5px;
            vertical-align: top;
            display: inline-block;
        }

        .rptStartDate, .rptEndDate {
            /*max-width:100px;*/
            text-align: center;
        }

        .container {
            width: 100% !important;
        }

        .requiredText {
            color: red !important;
        }

        .rptButton {
            vertical-align: top;
            display: inline-block;
            float: right;
        }
    </style>

</head>
<body style="display:none">
    <div id="fh5co-page">
        <header id="fh5co-header" role="banner">
            <div class="container">
                <div class="header-inner" id="menu"></div>
            </div>
        </header>
        <div id="fh5co-contact-section" class="contact-section">
            <div class="container">
                <div class="row"  id="reportTitleRow">
                    <div class="col-md-6 col-md-offset-3 text-center fh5co-heading">
                        <h2 id="reportTitle"></h2>
                    </div>
                </div>
                <div id="divQuickReport" style="float:right;padding-right:0px;padding-bottom:0px;margin-top:-100px">
                    <label for="ddlQuickReport" class="search-ddl-label" style="text-align:right">Reports:&nbsp;</label>
                    <select class="search-ddl-select" onchange="getQuickReport(this.value)" style="width:207px;font-size:14px" id="ddlQuickReport"></select>
                </div>
                <!-- search / filter area -->
                <div class="row search-section">
                    <div class="col-md-12 ">
                        <!--
                        market
                        media code
                        media type (only has newspaper and television)
                        advertiser name
                        station advertiser name
                        market advertiser name
                        media advertiser name

                        parent advertiser
                        industry
                        sub industry

                        agency name
                        station agency name
                        market agency name
                        ownership

                        parent agency

                        revenue research
                        need radio button set with newspaper, television or both (media research)
                        from date
                        to date

                        -->
                        <div class="form-group rptView auditProduct">
                            <label for="ddlProduct" class="dropdown-label rptView auditProduct">Product</label>
                            <select id="ddlProduct" apiInput="inProductId" class="dropdown-select rptView auditProduct"></select>
                        </div>
                        <div class="form-group rptView auditMarket">
                            <label for="ddlMarket" class="dropdown-label rptView auditMarket">Market</label>
                            <select id="ddlMarket" apiInput="inMarketId" class="dropdown-select rptView auditMarket"></select>
                        </div>
                        <div class="form-group rptView auditStation">
                            <label for="ddlStation" class="dropdown-label rptView auditStation">Station</label>
                            <select id="ddlStation" apiInput="inStationId" class="dropdown-select rptView auditStation"></select>
                        </div>
                        <div class="form-group rptView auditMediaCode">
                            <label for="ddlMediaCode" class="dropdown-label rptView auditMediaCode">Media Code</label>
                            <select id="ddlMediaCode" apiInput="inMediaCodeId" class="dropdown-select rptView auditMediaCode"></select>
                        </div>
                        <div class="form-group rptView auditMediaType">
                            <label for="ddlMediaType" class="dropdown-label rptView auditMediaType">Media Type</label>
                            <select id="ddlMediaType" apiInput="inMediaTypeId" class="dropdown-select rptView auditMediaType"></select>
                        </div>
                        <div class="form-group rptView auditAdvertiserName">
                            <label for="txtAdvertiserName" class="dropdown-label rptView auditAdvertiserName">Advertiser Name </label>
                            <input type="text" id="txtAdvertiserName" apiInput="inAdvertiserName" class="dropdown-label rptView auditAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditStationAdvertiserName">
                            <label for="txtStationAdvertiserName" class="dropdown-label rptView auditStationAdvertiserName">Station Advertiser Name </label>
                            <input type="text" id="txtStationAdvertiserName" apiInput="inStationAdvertiserName" class="dropdown-label rptView auditStationAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditMediaAdvertiserName">
                            <label for="txtMediaAdvertiserName" class="dropdown-label rptView auditMediaAdvertiserName">Media Advertiser Name </label>
                            <input type="text" id="txtMediaAdvertiserName" apiInput="inMediaAdvertiserName" class="dropdown-label rptView auditMediaAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditAgencyName">
                            <label for="txtAgencyName" class="dropdown-label rptView auditAgencyName">Agency Name </label>
                            <input type="text" id="txtAgencyName" apiInput="inAgencyName" class="dropdown-label rptView auditAgencyName" />
                        </div>
                        <div class="form-group rptView auditStationAgencyName">
                            <label for="txtStationAgencyName" class="dropdown-label rptView auditStationAgencyName">Station Agency Name </label>
                            <input type="text" id="txtStationAgencyName" apiInput="inStationAgencyName" class="dropdown-label rptView auditStationAgencyName" />
                        </div>
                        <div class="form-group rptView auditMarketAdvertiserName">
                            <label for="txtMarketAdvertiserName" class="dropdown-label rptView auditMarketAdvertiserName">Market Advertiser Name </label>
                            <input type="text" id="txtMarketAdvertiserName" apiInput="inMarketAdvertiserName" class="dropdown-label rptView auditMarketAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditMarketAgencyName">
                            <label for="txtMarketAgencyName" class="dropdown-label rptView auditMarketAgencyName">Market Agency Name </label>
                            <input type="text" id="txtMarketAgencyName" apiInput="inMarketAgencyName" class="dropdown-label rptView auditMarketAgencyName" />
                        </div>
                        <div class="form-group rptView auditFirstName">
                            <label for="txtFirstName" class="dropdown-label rptView auditFirstName">First Name </label>
                            <input type="text" id="txtFirstName" apiInput="inFirstName" class="dropdown-label rptView auditFirstName" />
                        </div>
                        <div class="form-group rptView auditLastName">
                            <label for="txtLastName" class="dropdown-label rptView auditLastName">Last Name </label>
                            <input type="text" id="txtLastName" apiInput="inLastName" class="dropdown-label rptView auditLastName" />
                        </div>
                        <div class="form-group rptView auditIndustry">
                            <!-- industry -->
                            <label for="ddlIndustry" class="dropdown-label rptView auditIndustry">Industry</label>
                            <select id="ddlIndustry" apiInput="inIndustryId" class="dropdown-select rptView auditIndustry"></select>
                        </div>
                        <div class="form-group rptView auditSubIndustry">
                            <!-- subindustry -->
                            <label for="ddlSubIndustry" class="dropdown-label rptView auditSubIndustry">Sub Industry</label>
                            <select id="ddlSubIndustry" apiInput="inSubIndustryId" class="dropdown-select rptView auditSubIndustry"></select>
                        </div>
                        <div class="form-group rptView auditParentAdvertiser">
                            <!-- parent advertiser using generic search functionality-->
                            <div class="form-group" style="display:table-cell;">
                                <label for="hidParentAdvertiser" class="dropdown-label rptView auditParentAdvertiser">Parent Advertiser</label>
                                <input type="text" id="txtParentAdvertiser" onclick="getParentAdvertiser()" readonly class="dropdown-select rptView auditParentAdvertiser" />
                                <a class="rptView auditParentAdvertiser" href="#" onclick="clearSelection('ParentAdvertiser')">X</a>
                                <input type="hidden" id="hidParentAdvertiser" apiInput="inParentAdvertiserId" class="dropdown-select rptView auditParentAdvertiser" />
                            </div>
                        </div>

                        <div class="form-group rptView auditParentAdvertiserName">
                            <label for="txtParentAdvertiserName" class="dropdown-label rptView auditParentAdvertiserName">Parent Advertiser</label>
                            <input type="text" id="txtParentAdvertiserName" apiInput="inParentAdvertiserName" class="dropdown-select rptView auditParentAdvertiserName" />
                        </div>


                        <div class="form-group rptView auditParentMarket">
                            <label for="ddlParentMarket" class="dropdown-label rptView auditParentMarket">Parent Market</label>
                            <select id="ddlParentMarket" apiInput="inParentMarketId" class="dropdown-select rptView auditParentMarket ui search dropdown"></select>
                        </div>
                        <div class="form-group rptView auditParentAgency">
                            <div class="form-group" style="display:table-cell;">
                                <label for="hidParentAgency" class="dropdown-label rptView auditParentAgency">Parent Agency</label>
                                <input type="text" id="txtParentAgency" onclick="getParentAgency()" readonly class="dropdown-select rptView auditParentAgency" />
                                <a class="rptView auditParentAgency" href="#" onclick="clearSelection('ParentAgency')">X</a>
                                <input type="hidden" id="hidParentAgency" apiInput="inParentAgencyId" class="dropdown-select rptView auditParentAgency" />
                            </div>
                        </div>

                        <div class="form-group rptView auditParentAgencyName">
                            <label for="txtParentAgencyName" class="dropdown-label rptView auditParentAgencyName">Parent Agency</label>
                            <input type="text" id="txtParentAgencyName" apiInput="inParentAgencyName" class="dropdown-select rptView auditParentAgencyName" />
                        </div>

                        <div class="form-group rptView auditOwner">
                            <label for="ddlOwner" class="dropdown-label rptView auditOwner">Owner</label>
                            <select id="ddlOwner" apiInput="inOwnerId" class="dropdown-select rptView auditOwner"></select>
                        </div>
                        <div class="form-group rptView auditAccountType">
                            <label for="ddlAccountType" class="dropdown-label rptView auditAccountType">Account Type</label>
                            <select id="ddlAccountType" apiInput="inAccountTypeId" class="dropdown-select rptView auditAccountType"></select>
                        </div>
                        <div class="form-group auditStartDate rptView">
                            <label for="dtStartDate" class="dropdown-label auditStartDate rptView">Start Date</label>
                            <input type="text" id="dtStartDate" class="auditStartDate rptView" style="max-width: 100px;" apiInput="inStartDate">
                        </div>
                        <div class="form-group auditEndDate rptView">
                            <label for="dtEndDate" class="dropdown-label auditEndDate rptView">End Date</label>
                            <input type="text" id="dtEndDate" class="auditEndDate rptView" style="max-width: 100px;" apiInput="inEndDate">
                        </div>
                        <div class="form-group col-md-3 rptButton" style="text-align: right">
                            <label for="btnReport" class="dropdown-label">&nbsp;</label>
                            <input type="button" id="btnReport" class="search-button" value="Show" onclick="getReport()" />
                        </div>
                    </div>
                    <div class="col-md-12 multi-field-message-area" style="display: none;">
                        <p class="multi-field-message">** At least one of the following fields needs to be completed: </p>
                    </div>
                    <div id="header-summary-section" class="row search-section" style="padding-top:20px">
                        <div class="col-md-12 ">
                            <center>
                                <div id="header-summary" style="text-align:center; border:solid 1px silver; border-radius:15px;background-color:lightblue;width:50%">
                                </div>
                            </center>
                        </div>
                    </div>
                </div>

                <!-- start datatable coding-->

                <div class="dataTable-top-margin">
                    <center>
                        <div id="dtResultsHolder">
                            <table id="dtResults" class="cell-border"></table>
                        </div>
                        <div id="noDataFound" style="display:none; color: red">No data found</div>
                    </center>
                </div>

                <!-- end datatable coding-->

            </div>
        </div>
    </div>


    <!-- jQuery -->
    <script src="/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!-- Waypoints -->
    <script src="/js/jquery.waypoints.min.js"></script>
    <!-- BlockUI JS -->
    <script src="/js/blockUI.js"></script>
    <!-- Config JS -->
    <script src="/js/config.js"></script>
    <!-- MAIN JS -->
    <script src="/js/main.js"></script>
    <!-- genericReport JS -->
    <script src="/js/genericReport.js"></script>


    <script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- JavaScript for Chosen dropdown -->
    <script src="/js/chosen.jquery.min.js"></script>

</body>
</html>
<script>

    var reportObject = new Object();
    var reportFilterArray = new Array();

    var api = "";
    var apiParameters = new Object();
    var apiToken = "";
    var searchText = "";
    var columns = [];
    var columnsToDisplay = new Array();
    var columnsToExport = new Array();
    var reportId = 0;

    var startDate = "";
    var endDate = "";

    var tableFooterCallback = new Object();
    var gHideHeader = null;
    var gMessageSubTitle = '';

    $(document).ready(function ()
    {

        gHideHeader = getParameterByName("hideHeader");
        $("#header-summary-section").hide();
        showHeader();

        LoadDefaultDates();

        reportId = getParameterByName("reportId");

        if (validReportIdCheck(reportId) == false)
        {
            return;
        }

        setupDatePickers();

        // get report objects
        reportObject = getReportObject(reportId);
        reportFilterArray = reportObject.filters;

        if (reportObject.apiControllerAction == null || reportObject.apiControllerAction.length == 0)
        {
            var msg = reportObject.reportTitle + " Report has not been implemented.";
            bootbox.alert(msg, function () { window.location = "/products/xry/xrygenericreport.html"; });
            return false;
        }

        tableFooterCallback = setFooterCallback(reportObject);


        // report title
        $("#reportTitle").html(reportObject.reportTitle);

        setUIEvents();

        // build menu
        buildXRYMenu("Audits");
        buildQuickReports(reportObject.product);

        // display filters
        displayFilters(reportFilterArray);

        loadOnChangeEvents(reportFilterArray);

        setAutoRun(reportFilterArray);

    });
    function validReportIdCheck(reportId)
    {
        var bReturn = true;

        if (!reportId)
        {

            //if we got here from js/main.js goBackToDashboard(), then extract reportId and redirect
            var searchParams = getParameterByName("search");
            if (searchParams != null)
            {
                searchParams = searchParams.toLowerCase().split('|');
                if (searchParams.length > 0)
                {
                    if (searchParams[0].indexOf('reportid=') >= 0)
                    {
                        reportId = searchParams[0].substring(9, searchParams[0].length);
                        getQuickReport(reportId);
                        return false;
                    }
                }
            }

            //else punt
            var msg = "Invalid page request, no report passed."; 
            bootbox.alert(msg, function () { window.location = "/admin/login/dashboard.html"; });
            return false;
        }
        else
        {

            return true;
        }
    }

    function setUpBackButton()
    {
        setLocalStorage("search", "reportId=" + getParameterByName("reportId"));
        setLocalStorage("searchPage", window.location);
        //setLocalStorage("quickReportQS", "ddlMarket|" + $("#ddlMarket").val());
    }

    function setAutoRun(reportFilterArray)
    {
        // Auto Run
        if (reportFilterArray.length == 0) {
            getReport();
            $("#btnReport").hide();
        }
        else
        {
            $("#btnReport").show();
            setTimeout('loadAdvancedSearch()', 1000);
        }
    }

    function setUIEvents()
    {
        $("select").change(function () {

            $("#btnReport").addClass("flash-button");
            $(document).unbind('ajaxStart');
            $(document).unbind('ajaxStop');

        });

        // clear
        $("body").on("click",
            "#clear_search_button",
            function () {
                var table = $("#dtAgencyList").DataTable();
                table.search('').draw();
            });
    }
    function setFooterCallback(reportObject)
    {
        var tableFooterCallback = function () { };

        if (reportObject.footerCallback !== undefined || reportObject.footerCallback !== "undefined")
        {
            tableFooterCallback = reportObject.footerCallback;
        }
 

        return tableFooterCallback;
    }
    function setupDatePickers()
    {
        // setup date pickers
        $(function () {
            $("#dtStartDate").datepicker();
            $("#dtEndDate").datepicker();
        });

    }

    function clearSelection(control) {
        $("#txt" + control).val("");
        $("#hid" + control).val("");
    }

    function loadAdvancedSearch()
    {

        $.blockUI;

        var searchResults = getLocalStorage("gSearchResults");

        if (!searchResults)
        {
            runReportFromAdvancedSearch();
            return;
        }

        var searchCriteria = $.parseJSON(searchResults);

        //will need to load for parent advertiser or parent agency
        //parent advertiser
        if (searchCriteria["searchToken"].toUpperCase() == "PARENTADVAUDIT") {

            //market,
            $("#ddlMarket").val(searchCriteria["ddlMarket"]);
            //media code,
            $("#ddlMediaCode").val(searchCriteria["ddlMediaCode"]);
            //media type,
            $("#ddlMediaType").val(searchCriteria["ddlMediaType"]);
            //advertiser name
            $("#txtAdvertiserName").val(searchCriteria["txtAdvertiserName"]);
            //industry
            $("#ddlIndustry").val(searchCriteria["ddlIndustry"]);
            //subindustry
            getSubIndustryList(searchCriteria["ddlIndustry"], searchCriteria["ddlSubIndustry"]);

            //parentadvertiser
            $("#hidParentAdvertiser").val(searchCriteria["hidParentAdvertiser"]);
            $("#txtParentAdvertiser").val(searchCriteria["txtParentAdvertiser"]);

            searchCriteria["hidParentAdvertiser"] = "";
            searchCriteria["txtParentAdvertiser"] = "";
            //setLocalStorage("gSearchResults", JSON.stringify(searchCriteria));
            setLocalStorage("gSearchResults", "");

        }
            //parent agency
        else if (searchCriteria["searchToken"].toUpperCase() == "PARENTAGENCYAUDIT") {

            $("#ddlMarket").val(searchCriteria["ddlMarket"]);
            $("#ddlMediaType").val(searchCriteria["ddlMediaType"]);
            $("#txtAgencyName").val(searchCriteria["txtAgencyName"]);
            $("#hidParentAgency").val(searchCriteria["hidParentAgency"]);
            $("#txtParentAgency").val(searchCriteria["txtParentAgency"]);

            searchCriteria["hidParentAgency"] = "";
            searchCriteria["txtParentAgency"] = "";

            //setLocalStorage("gSearchResults", JSON.stringify(searchCriteria));
            setLocalStorage("gSearchResults", "");
        }

        runReportFromAdvancedSearch();

    }

    function runReportFromAdvancedSearch()
    {
        setTimeout('getReport(true)', 500);
    }

    function preSelectItem(whatToCheckFor) {
        var preSelectedValue = getLocalStorage(whatToCheckFor);

        if (!preSelectedValue) {
            return;
        }
        var preSelectedArray = preSelectedValue.split("|");

        if (preSelectedArray.length < 2) {
            return;
        }

        $("#" + preSelectedArray[0]).val(preSelectedArray[1]);
        setTimeout(getReport, 1000);
    }

    function saveLoadedControlSelection(control) {
        var searchResults = getLocalStorage("gSearchResults");

        if (!searchResults) {
            return;
        }

        var searchCriteria = $.parseJSON(searchResults);
        $("#" + control).val(searchCriteria[control]);

    }

    function LoadDefaultDates() {
        var d = new Date();
        var currentMonth = d.getMonth() + 1;
        var currentYear = d.getFullYear();
        var lastDayOfTheMonth = new Date(d.getFullYear(), d.getMonth() + 1, 0);

        $("#dtStartDate").val(currentMonth + "/01/" + currentYear);
        $("#dtEndDate").val(currentMonth + "/" + lastDayOfTheMonth.getDate() + "/" + currentYear);

        saveLoadedControlSelection("dtStartDate");
        saveLoadedControlSelection("dtEndDate");

    }

    function displayFilters(arrayFilters) {

        // set all filters display to none
        $(".rptView").hide();

        for (var i = 0; i < arrayFilters.length; i++) {

            activateFilter(arrayFilters[i]);
            var input = $("#" + arrayFilters[i].objectName);

            if (arrayFilters[i].required == true) {

                //var input = $("#" + arrayFilters[i].objectName);
                $("label[for=" + input.attr("id") + "]").css("color", "red");
                $("label[for=" + input.attr("id") + "]").prepend(" * ");

            }

            if (arrayFilters[i].multiFieldOption !== "undefined" && arrayFilters[i].multiFieldOption == true) {
                $("label[for=" + input.attr("id") + "]").prepend(" ** ");

                if ($(".multi-field-message-area").is(":visible")) {
                    $(".multi-field-message").append(" or " + $("label[for=" + input.attr("id") + "]").text().replace(/\*/g, ''));
                } else {
                    $(".multi-field-message").append(" " + $("label[for=" + input.attr("id") + "]").text().replace(/\*/g, ''));
                    $(".multi-field-message-area").show();
                }

            }
        }

    }

    function activateFilter(filterObject) {

        //var classToShow = "audit" + filterObject.token;
        //$("." + classToShow).show();

        //if (filterObject.jsCall == null) {
        //    return;
        //}

        //window[filterObject.jsCall]();

        var classToShow = "audit" + filterObject.token;
        $("." + classToShow).show();

        //$(filterObject.).hide();
        if ($("#" + filterObject.objectName + "_chosen").length > 0) {
            $("#" + filterObject.objectName).hide();
        }


        if (filterObject.jsCall == null) {
            return;
        }


        var jsCallParams = (filterObject.jsCallParameters == undefined ? new Array() : filterObject.jsCallParameters);

        var fn = window[filterObject.jsCall];
        fn.apply(filterObject, jsCallParams);

    }

    //--------------------------------
    // Filters get loaded here
    //--------------------------------

    function getXRYMediaCodeList() {
        $.ajax({
            url: ServicePrefix + '/api/MediaCode/GetMediaCodeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Media Code --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].mediaCodeId + '">' + data.report.rows[index].mediaCodeDescription + '</option>';

                    });

                    $("#ddlMediaCode").html(str);

                    convertToChosenSelect('ddlMediaCode', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

                    saveLoadedControlSelection("ddlMediaCode");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getMediaTypeList() {

        $.ajax({
            url: ServicePrefix + '/api/MediaType/GetMediaTypeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Media Type --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].MediaTypeID + '">' + data.report.rows[index].MediaTypeName + '</option>';

                    });

                    $("#ddlMediaType").html(str);

                    convertToChosenSelect('ddlMediaType', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

                    saveLoadedControlSelection("ddlMediaType");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    function getMediaAdvertiserMediaTypeList() {

        $.ajax({
            url: ServicePrefix + '/api/MediaAdvertiser/GetMediaAdvertiserMediaTypeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Media Type --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].mediaTypeId + '">' + data.report.rows[index].mediaType + '</option>';

                    });

                    $("#ddlMediaType").html(str);

                    convertToChosenSelect('ddlMediaType', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

                    saveLoadedControlSelection("ddlMediaType");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    function getIndustryList() {
        $.ajax({
            url: ServicePrefix + '/api/Industry/GetIndustryList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="-1">-- Select an Industry --</option>';

                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].industryId + '">' + data.report.rows[index].industryName + '</option>';

                    });

                    $("#ddlIndustry").html(str);

                    convertToChosenSelect('ddlIndustry', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

                    saveLoadedControlSelection("ddlIndustry");

                }

            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getAccountTypeList() {
        $.ajax({
            url: ServicePrefix + '/api/AccountType/GetAccountTypeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select an Account Type --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].accountTypeId + '">' + data.report.rows[index].accountTypeName + '</option>';

                    });

                    $("#ddlAccountType").html(str);

                    convertToChosenSelect('ddlAccountType', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

                    saveLoadedControlSelection("ddlAccountType");

                }

            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getDefaultSubIndustry() {
        $("#ddlSubIndustry").html('');

        var str = '';
        str = '<option value="-1">-- Select a Sub Industry --</option>';
        $("#ddlSubIndustry").html(str);
        convertToChosenSelect('ddlSubIndustry', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

    }

    function getDefaultOwner() {
        $("#ddlOwner").html('');

        var str = '';
        str = '<option value="-1">-- Select an Owner --</option>';
        $("#ddlOwner").html(str);
        convertToChosenSelect('ddlOwner', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);
    }

    function getPeriodListQuarters() {
        getPeriodList("quarters");
    }

    function getPeriodListMonths() {
        getPeriodList("months");
    }

    function getXRYMarketList() {
        getMarketList('XRY');
    }

    function getXrayStationList() {
        getStationList('XRY');
    }

    function getMarketList(inProduct) {

        $.ajax({
            url: ServicePrefix + '/api/Market/GetMarketListByProduct',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inProductId": inProduct,
                "inActiveOnly ": true
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Market --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].marketId + '">' + data.report.rows[index].marketName + ' (' + data.report.rows[index].marketId + ')' + '</option>';

                    });

                    $("#ddlMarket").html(str);

                    convertToChosenSelect('ddlMarket', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);
                    saveLoadedControlSelection("ddlMarket");
                    //preSelectItem('quickReportQS');

                }

            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    function getStationList(inProduct) {

        $.ajax({
            url: ServicePrefix + '/api/Station/GetStationListByProduct',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inProductId": inProduct,
                "inActiveOnly ": true
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Station --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].reid + '">' + data.report.rows[index].fullName + '</option>';

                    });

                    $("#ddlStation").html(str);

                    convertToChosenSelect('ddlStation', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);
                    saveLoadedControlSelection("ddlStation");

                }

            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    //--------------------------------
    // Filters get loaded end here
    //--------------------------------

    //////----------------------
    ////// BEGIN: load of the reports and supporting routines
    //////---------------------
    function getReport(bSilent) {

        if (!bSilent)
        {
            bSilent = false;
        }

        hideHeader();

        $("#noDataFound").hide();

        api = reportObject.apiControllerAction;
        apiParameters = new Object();
        apiToken = getLocalStorage("APIToken");
        searchText = "";
        columns = [];

        //------------------------
        //setup the parameters for the API
        //------------------------

        if (reportObject.apiType.toLowerCase() == "post") {
            apiParameters["inApiToken"] = apiToken;
        }
        else {
            api = api + "?inApiToken=" + apiToken;
        }

        //------------------------
        // loop thru filters
        //------------------------
        var itemsToCheckLength = reportFilterArray.length;

        //-------------------------------
        // This is the no filter use case
        //-------------------------------
        if (itemsToCheckLength == 0) {
            getTheReportAJAX();
            return;
        }

        var hasMultiField = false;
        var oneMultiFieldCompleted = false;

        for (var i = 0; i < reportFilterArray.length; i++) {
            var filterObject = reportFilterArray[i];

            if (filterObject.multiFieldOption !== undefined) {
                hasMultiField = true;
            }
        }

        gMessageSubTitle = "";

        $.each(reportFilterArray, function (objectName, objectValue)
        {

            var control = objectValue.objectName;
            var nameOfParm = $("#" + control).attr("apiInput");
            var item = "#" + control;
            var isRequired = objectValue.required;

            var isMultiField = objectValue.multiFieldOption !== undefined ? objectValue.multiFieldOption : false;

            var val = $(item).val();
            var text = $(item).val();

            if (control.toString().toLowerCase().indexOf("chk") > -1) {
                val = $(item).is(':checked').toString();

                text = (val == true ? "selected" : "not-selected");
            }

            if (control.toString().toLowerCase().indexOf("ddl") > -1) {
                text = $(item + " option:selected").text();
            }

            if (val != null && val.length > 0) {
                if (reportObject.apiType.toLowerCase() == "post") {
                    apiParameters[nameOfParm] = val;
                }
                else {
                    api = api + "&" + nameOfParm + "=" + val;
                }

                if (isMultiField) {
                    oneMultiFieldCompleted = true;
                }

            }
            else {
                if (isRequired) {
                    var msg = "Please select a " + nameOfParm.toLowerCase().replace("in", "").replace("id", "");
                    if (bSilent == false) {
                        bootbox.alert(msg, function () { });
                    }
                    return false;
                }
            }

            if (!val == false) {
                if (val.length > 0 && val != "-1") {
                    if (gMessageSubTitle.length > 0) {
                        gMessageSubTitle = gMessageSubTitle + ",&nbsp;&nbsp;";
                    }

                    gMessageSubTitle = gMessageSubTitle + "<b>" + nameOfParm.toLowerCase().replace("in", "").replace("id", "").toUpperCase() + ":</b>&nbsp;";
                    gMessageSubTitle = gMessageSubTitle + text;
                }
            }

            // when done with the loop
            // get the report
            if (objectName == (itemsToCheckLength - 1)) {

                if (hasMultiField && oneMultiFieldCompleted == false) {
                    var msg = "Please complete at least one field with **.";
                    if (bSilent == false) {
                        bootbox.alert(msg, function () { });
                    }
                    //bootbox.alert(msg, function () { });
                    return false;
                }

                getTheReportAJAX();
            }

        });

        if (gMessageSubTitle.length > 0) {
            gMessageSubTitle = gMessageSubTitle + "<br>";
        }

    }

    function hideHeader() {
        $("#header-summary-section").hide();
        $("#header-summary").html('');
    }

    function getTheReportAJAX() {

        $(document).ajaxStart($.blockUI).ajaxStop($.unblockUI);
        $("#btnReport").removeClass("flash-button");

        clearTimeout(unblockHandle);

        $.ajax({
            url: ServicePrefix + api,
            dataType: 'json',
            type: reportObject.apiType.toString().toLowerCase(),
            contentType: 'application/json',
            data: JSON.stringify(apiParameters),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                if (data.response.status.toUpperCase() === "SUCCESS") {

                    buildColumnsArray(data);

                }
                else {
                    var msg = data.response.errorMessage[0];
                    bootbox.alert(msg, function () { });
                    return false;
                }
            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function destroyDataTable() {
        if ($.fn.DataTable.isDataTable('#dtResults')) {
            var searchTable = $('#dtResults').DataTable();
            searchTable.destroy();
            $('#dtResults').hide();
        }

    }

    function buildColumnsArray(dataObj) {
        columnsToExport = new Array();

        if (!dataObj["report"]["rows"]) {
            destroyDataTable();
            hideHeader();
            $("#noDataFound").show();

            return;
        }

        if (dataObj["report"]["rows"].length == 0) {
            destroyDataTable();
            hideHeader();
            $("#noDataFound").show();
            return;
        }
        $('#dtResults').show();

        var data = dataObj["report"]["rows"][0];
        var ctr = -1;

        $.each(data, function (objectName, objectValue) {

            if (reportObject.columnsToDisplay.length == 0 || IsInArray(reportObject.columnsToDisplay, objectName) == true)
            {

                var className = "";

                if (objectValue === null)
                {
                    className = "";
                }
                else
                {

                    if ((isNaN(objectValue) == true))
                    {
 
                        if (objectValue.toString().length > 0)
                        {
                            className = "text-align-left";
                        }

                        if (objectValue.toString().indexOf("%") > -1)
                        {
                            className = "text-align-right";
                        }

                        if (objectValue.toString().indexOf("$") > -1)
                        {
                            className = "text-align-right";
                        }
                    }
                    else
                    {
                        className = "text-align-right";
                    }
                }

                ctr++;
                columnsToExport.push(ctr);

                var bSortable = true;
                if (reportObject.sortable == 'undefined') {
                    bSortable = true;

                } else {
                    bSortable = reportObject.sortable;
                }

                columns.push(buildCustomLink(objectName, data, bSortable, className));

                //columns.push({
                //    "title": objectName,
                //    "visible": true,
                //    "mData": objectName,
                //    "orderable": bSortable,
                //    "className": className
                //});
            }

        });

        //find the object in the columns that have any actions
        //created an array of possible actions in genericXrayReport.js
        //currently there is only edit
        //if the action is found, the column will be added to the table.
        //this has to be done after the fact since these columns do not come back
        //in the data.
        for (var i = 0; i < reportActionsArray.length; i++) {
            var actionIndex = GetActionColumnIndex(reportObject, reportActionsArray[i]);
            //a -1 means the item wasn't found in the array
            if (actionIndex > -1) {
                columns.push(reportObject.columnsToDisplay[actionIndex]);
            }
        }

        var width = 95;

        if (ctr <= 3) {
            width = ctr * 30;
        }

        if (width < 50) {
            width = 50;
        }

        $("#dtResults").width(width + '%');

        loadResults(dataObj, columns);
    }

    function GetActionColumnIndex(reportObject, actionName)
    {
        return reportObject.columnsToDisplay.map(
            function (x) {
                return x.action;
            }).indexOf(actionName);
    }

    function IsInArray(arrayToSearch, valToFind) {
        for (var i = 0; i < arrayToSearch.length; i++) {
            //console.log(arrayToSearch[i] + " " + valToFind);
            if (typeof arrayToSearch[i] !== "object" && arrayToSearch[i].toLowerCase() == valToFind.toLowerCase()) {
                return true;
            }
        }
        return false;
    }

    function loadResults(data, columns) {
        //data is the data from the ajax call
        //columns is the array that was built previously

        //Since some of the audit have footer with calculations,
        //the footer needs to be added to the table html before the
        //datatable is initialized. Otherwise the footer can't be added later.
        if (reportObject.footerFormat !== "undefined" && $(".rev-research-footer").length === 0) {
            $("#dtResults").append(reportObject.footerFormat);
        }

        //assigns the data from the ajax call
        var results = data["report"]["rows"];

        //creating a variable that will used for datatable functions later
        var searchTable;

        //if the datatable already exists need to destroy it before building it
        //again with new results from the search.
        //if you try to destroy before it is a datatable, an error will occur.
        //this code will only destroy it if the table is a datatable.
        if ($.fn.DataTable.isDataTable('#dtResults')) {
            searchTable = $('#dtResults').DataTable();
            searchTable.destroy();
        }

        resetDataTableDOM("dtResults", "dtResultsHolder", "cell-border");

        //this code rebuilds the datatable with the updated data from the search
        //or initial load.

        searchTable = $("#dtResults").DataTable({
            "dom": "Blfrtip",
            "pageLength": gDataTableDefaultRows,
            "order": [],
            "data": results,
            "columns": columns,
            "select": true,
            language: {
                search: "Filter Results:"
            },
            "buttons": [
               //{
               //    extend: 'csv',
               //    exportOptions: {
               //        columns: columnsToExport
               //    }
               //},
               {
                   extend: 'excel',
                   title: reportObject.reportTitle,
                   exportOptions: {
                       columns: columnsToExport
                   }
               },
               //{
               //    extend: 'pdf',
               //    title: auditObject.reportTitle,
               //    exportOptions: {
               //        columns: columnsToExport
               //     }
               //},
               {
                   extend: 'print',
                   title: reportObject.reportTitle,
                   messageTop: gMessageSubTitle,
                   customize: function (win) {
                       $(win.document.body)
                           .css('font-size', '12pt');


                       $(win.document.body).find('table')
                           .addClass('compact')
                           .css('font-size', '8pt');
                   },
                   exportOptions: {
                       columns: columnsToExport

                   }
               }
            ],
            "footerCallback": tableFooterCallback
        });

    }
    //----------------------
    // END: load of the reports and supporting routines
    //---------------------

    //--------------------
    // misc
    //--------------------
    function loadLastSearch() {
        var search = getParameterByName("search");

        if (!search == false) {
            if (search.length > 0) {

                var sArray = new Array();
                sArray = search.split("|");

                $("#searchText").val(sArray[0]);
                $("#ddlMarket").val(sArray[1].toString());

                getAgencyList();
            }
        }

    }

    //this function takes in a page location and an id
    //if there needs to be more than page parameter
    //this function will need to be modified
    //this will direct to the proper page and id for editing, etc.
    function loadActionPage(pageLocation, itemId)
    {
 
        if (!gHideHeader == false && gHideHeader == "true" )
        {
            localStorage.removeItem("search");
            localStorage.removeItem("searchPage");
            $("#componentDialog").dialog("close");
        }

        window.top.location = pageLocation + itemId;


    }

    function getPropertyObjectByToken(token) {
        for (var i = 0; i < reportFilterArray.length - 1; i++) {
            if (reportFilterArray[i].token.toLowerCase() == token.toLowerCase()) {
                return reportFilterArray[i];
            }
        }
    }

    function loadOnChangeEvents(reportFilterArray) {

        for (var i = 0; i < reportFilterArray.length - 1; i++) {

            if (reportFilterArray[i].onchange != "undefined") {

                $("#" + reportFilterArray[i].objectName).change(reportFilterArray[i].onchange);

            }
        }
    }

    function getParentAdvertiser() {

        var searchCriteriaObj = {
            "searchToken": "PARENTADVAUDIT",
            "ddlMarket": $("#ddlMarket").val(),
            "ddlMediaCode": $("#ddlMediaCode").val(),
            "ddlMediaType": $("#ddlMediaType").val(),
            "txtAdvertiserName": $("#txtAdvertiserName").val(),
            "ddlIndustry": $("#ddlIndustry").val(),
            "ddlSubIndustry": $("#ddlSubIndustry").val(),
            "hidParentAdvertiser": $("#hidParentAdvertiser").val(),
            "txtParentAdvertiser": $("#txtParentAdvertiser").val(),
            "searchPage": window.location
        }

        setLocalStorage("gSearchCriteria", JSON.stringify(searchCriteriaObj));

        window.location = "/utilities/search.html";

    }

    function getParentAgency() {

        var searchCriteriaObj = {
            "searchToken": "PARENTAGENCYAUDIT",
            "ddlMarket": $("#ddlMarket").val(),
            "ddlMediaType": $("#ddlMediaType").val(),
            "txtAgencyName": $("#txtAgencyName").val(),
            "hidParentAgency": $("#hidParentAgency").val(),
            "txtParentAgency": $("#txtParentAgency").val(),
            "searchPage": window.location
        }

        setLocalStorage("gSearchCriteria", JSON.stringify(searchCriteriaObj));

        window.location = "/utilities/search.html";
    }

    function clearSelection(control) {
        $("#txt" + control).val("");
        $("#hid" + control).val("");
    }

    function getSubIndustryList(industryId, subIndustryId) {

        if (industryId === "-1") {
            $("#ddlSubIndustry").html('');
            getDefaultSubIndustry();
            return;
        }

        $.ajax({
            url: ServicePrefix + '/api/SubIndustry/GetSubIndustryList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inShowDisabled": false,
                "inIndustryId": industryId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    $("#ddlSubIndustry").html('');

                    var str = '';
                    $("#ddlSubIndustry").html("<option value='-1'>-- Select a Sub Industry --</option>");

                    //var holdOwnerID = "0";

                    $.each(data.report.rows, function (index) {
                        var obj = data.report.rows[index];
                        str = str + '<option value="' + obj.subIndustryId + '">' + obj.subIndustryName + '</option>';
                    });

                    $("#ddlSubIndustry").append(str);

                    convertToChosenSelect('ddlSubIndustry', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

                    if (subIndustryId.length === 0) {
                        $("#ddlSubIndustry").val(-1);
                    } else {
                        $("#ddlSubIndustry").val(subIndustryId);
                    }

                }
            },
            error: function (jqXhr, textStatus, errorThrown) {
                MKAErrorMessageRtn(errorThrown);
            }
        });

    }

    function getOwnerList(marketId) {

        if (marketId == "") {

            $("#ddlOwner").html('');
            getDefaultOwner();
            return;
        }

        $.ajax({
            url: ServicePrefix + '/api/Owner/GetOwnerListByProductMarket',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inProductId": "XRY",
                "inMarketId": marketId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);

                }
                else {

                    var str = '';

                    $("#ddlOwner").html("<option value='-1'> -- Select an Owner --</option>");

                    var holdOwnerID = "0";

                    $.each(data.report.rows, function (index) {
                        var obj = data.report.rows[index];
                        str = str + "<option value='" + obj.ownerid + "'>" + obj.ownername + ' (' + obj.ownerid + ')' + "</option>";

                    });

                    $("#ddlOwner").append(str);

                    convertToChosenSelect('ddlOwner', gChosenParams.allowSearchContains, gChosenParams.allowSplitWordSearch);

                    saveLoadedControlSelection("ddlOwner");
                }

            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }
</script>
