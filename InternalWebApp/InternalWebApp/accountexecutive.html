<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MKA Internal Media Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700,900' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">
    <!-- Animate.css -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="/css/icomoon.css">
    <!-- Simple Line Icons -->
    <link rel="stylesheet" href="/css/simple-line-icons.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- Modernizr JS -->
    <script src="/js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
        <script src="js/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.2/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">


</head>
<body>

    <div id="fh5co-page">
        <header id="fh5co-header" role="banner">
            <div class="container">
                <div class="header-inner" id="menu"></div>
            </div>
        </header>

        <div id="fh5co-contact-section" class="contact-section">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-md-offset-3 text-center fh5co-heading">
                        <h2>Account Executive Detail</h2>
                    </div>
                </div>

                <div class="text-center" style="margin-top: 0">

                    <!--
                    First Name
                    Last Name
                    other information TBD
                    -->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtAccountExecutive">Account Executive</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input class="field-width-325 disabled" type="text" id="txtAccountExecutive" disabled="disabled" />
                        </div>
                    </div>

                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtOwner">Owner</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input class="field-width-325 disabled" type="text" id="txtOwner" disabled="disabled" />
                        </div>
                    </div>

                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtMarket">Market</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input class="field-width-325 disabled" type="text" id="txtMarket" disabled="disabled" />
                        </div>
                    </div>

                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtLinkedUser">Linked User</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input class="field-width-325 disabled" type="text" id="txtLinkedUser" disabled="disabled" />
                        </div>
                    </div>

                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtActiveDate">Active Date</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input class="field-width-325 disabled" type="text" id="txtActiveDate" disabled="disabled" />
                        </div>
                    </div>

                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtDisableDate">Disable Date</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input class="field-width-325 disabled" type="text" id="txtDisableDate" disabled="disabled" />
                        </div>
                    </div>

                    <div class="row input-row">
                        <div class="col-md-12 text-align-left">
                            <hr/>
                        </div>
                    </div>

                    <!-- assignment table -->
                    <div class="dataTable-top-margin">
                        <div>
                            <h3>Assignment List</h3>
                        </div>
                        <table id="dtAssignmentList" class="stripe text-align-left">
                            <thead>
                                <tr>
                                    <th class="exportColumn">Station</th>
                                    <th class="exportColumn">Owner</th>
                                    <th class="exportColumn">Advertiser</th>
                                    <th class="exportColumn">Agency Name</th>
                                    <th class="exportColumn">Active</th>
                                    <th class="exportColumn">Active Date</th>
                                    <th class="exportColumn">Disable Date</th>
                                </tr>
                            </thead>
                        </table>
                        <div id="noAssignmentDataFound" style="display: none; color: red">No data found</div>
                    </div>

                    <!-- conversion list -->
                    <div class="dataTable-top-margin">
                        <div>
                            <h3>Conversion List</h3>
                        </div>
                        <table id="dtConversionList" class="stripe text-align-left">
                            <thead>
                                <tr>
                                    <th class="exportColumn">Station</th>
                                    <th class="exportColumn">Owner</th>
                                    <th class="exportColumn">AE Code</th>
                                    <th class="exportColumn">AE Name</th>
                                </tr>
                            </thead>
                        </table>
                        <div id="noConversionDataFound" style="display: none; color: red">No data found</div>
                    </div>

                    <!-- Revenue List-->
                    <div class="dataTable-top-margin">
                        <div>
                            <h3>Revenue List</h3>
                        </div>
                        <table id="dtRevenueList" class="stripe text-align-left">
                            <thead>
                                <tr>
                                    <th class="exportColumn">Period</th>
                                    <th class="exportColumn">Total Revenue</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                        <div id="noRevenueDataFound" style="display: none; color: red">No data found</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!-- Waypoints -->
    <script src="/js/jquery.waypoints.min.js"></script>
    <!-- BlockUI JS -->
    <script src="/js/blockUI.js"></script>
    <!-- Config JS -->
    <script src="/js/config.js"></script>
    <!-- MAIN JS -->
    <script src="/js/main.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


</body>
</html>
<script>

    var iAccountExecutiveId = 0;

    var sAccountExecutive = "";
    var sOwner = "";
    var sMarket = "";
    var sLinkedUser = "";
    var sActiveDate = "";
    var sDisableDate = "";


    var assignmentExportColumns = returnTableColumnsByClass("dtAssignmentList", "exportColumn");
    var assignmentReportTitle = "Account Executive Assignment List";

    var conversionExportColumns = returnTableColumnsByClass("dtConversionList", "exportColumn");
    var conversionReportTitle = "Account Executive Conversion List";

    var revenueExportColumns = returnTableColumnsByClass("dtConversionList", "exportColumn");
    var revenueReportTitle = "Account Executive Revenue List";


    $(document).ready(function () {

        iAccountExecutiveId = (getParameterByName("AccountExecutiveID") == null ? 0 : getParameterByName("AccountExecutiveID"));
        sAccountExecutive = (getParameterByName("AEName") == null ? "" : getParameterByName("AEName"));
        sOwner = (getParameterByName("Owner") == null ? "" : getParameterByName("Owner"));
        sMarket = (getParameterByName("Market") == null ? "" : getParameterByName("Market"));
        sLinkedUser = (getParameterByName("LinkedUser") == null ? "" : getParameterByName("LinkedUser"));
        sActiveDate = (getParameterByName("ActiveDate") == null ? "" : getParameterByName("ActiveDate"));
        sDisableDate = (getParameterByName("DisableDate") == null ? "" : getParameterByName("DisableDate"));

        $("#txtAccountExecutive").val(sAccountExecutive);
        $("#txtOwner").val(sOwner);
        $("#txtMarket").val(sMarket);
        $("#txtLinkedUser").val(sLinkedUser);

        if (sActiveDate != "null") {

            var dtActiveDate = new Date(sActiveDate.toUpperCase());
            var sActiveDateFormatted = addZero(dtActiveDate.getMonth() + 1) + "/" + addZero(dtActiveDate.getDate()) + "/" + dtActiveDate.getFullYear();
            $("#txtActiveDate").val(sActiveDateFormatted);

        } else {
            $("#txtActiveDate").val("");
        }

        if (sDisableDate != "null") {

            var dtDisableDate = new Date(sDisableDate.toUpperCase());
            var sDisableDateFormatted = addZero(dtDisableDate.getMonth() + 1) + "/" + addZero(dtDisableDate.getDate()) + "/" + dtDisableDate.getFullYear();
            $("#txtDisableDate").val(sDisableDateFormatted);

        } else {
            $("#txtDisableDate").val("");
        }

        //get assignment list
        getAssignmentList();

        //get conversion list
        getConversionList();

        //get revenue list
        getRevenueList();

    });

    function getAssignmentList() {

        if (iAccountExecutiveId <= 0) {
            $("#noAssignmentDataFound").show();
            return;
        }

        $("#noAssignmentDataFound").hide();

        initializeAssignmentTable();

        getAssignmentData();

    }

    function initializeAssignmentTable() {
        $("#dtAssignmentList").DataTable({
            "dom": "Blfrtip",
            "pageLength": gDataTableDefaultRows,
            "data": [],
            "columns": [
                { "data": 'Station' },
                { "data": 'Owner' },
                { "data": 'Advertiser' },
                { "data": 'Agency Name' },
                { "data": 'Active' },
                { "data": 'Active Date' },
                { "data": 'Disable Date' }
            ],
            "pagingType": "full_numbers",
            "buttons": [
               {
                   extend: 'csv',
                   exportOptions: {
                       columns: assignmentExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtAssignmentList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'excel',
                   title: assignmentReportTitle,
                   exportOptions: {
                       columns: assignmentExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtAssignmentList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'pdf',
                   title: assignmentReportTitle,
                   exportOptions: {
                       columns: assignmentExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtAssignmentList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'print',
                   title: assignmentReportTitle,
                   exportOptions: {
                       columns: assignmentExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtAssignmentList", data, columnIdx);
                           }
                       }
                   }
               }
               //,
               //this button is supposed to handle column visibility
               //however it isn't working on our site
               //'colvis'
            ],
            initComplete: function () {
                $("#dtAssignmentList .dataTables_filter").append('<button type="button" class="clear-button" id="clear_search_button"><img width="29" height="29" src="/images/red-x.png" /></button>');
            },
            createdRow: function (row, data, index) {
                //this adds the class to every row
                $(row).addClass('single-line-height');
            },
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
    }

    function getAssignmentData() {

        //filling out url for ajax
        var url = ServicePrefix + '/api/AccountExecutive/GetAEAssignmentList';

        //filling out settings for ajax call
        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inAccountExecutiveId": iAccountExecutiveId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                //if(!data["report"]["rows"]) {
                //    destroyDataTable("dtAssignmentList");
                //    $("#noAssignmentDataFound").show();

                //    return;
                //}

                populateDataTable("dtAssignmentList", data);
            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        }

        //ajax call
        $.ajax(url, settings);

    }

    function getConversionList() {

        if (iAccountExecutiveId <= 0) {
            $("#noConversionDataFound").show();
            return;
        }

        $("#noConversionDataFound").hide();

        initializeConversionTable();

        getConversionData();
    }

    function initializeConversionTable() {

        $("#dtConversionList").DataTable({
            "dom": "Blfrtip",
            "pageLength": gDataTableDefaultRows,
            "data": [],
            "columns": [
                { "data": 'Station' },
                { "data": 'Owner' },
                { "data": 'AEC_AECode' },
                { "data": 'AEC_AEName' }
            ],
            "pagingType": "full_numbers",
            "buttons": [
               {
                   extend: 'csv',
                   exportOptions: {
                       columns: conversionExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtConversionList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'excel',
                   title: conversionReportTitle,
                   exportOptions: {
                       columns: conversionExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtConversionList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'pdf',
                   title: conversionReportTitle,
                   exportOptions: {
                       columns: conversionExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtConversionList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'print',
                   title: conversionReportTitle,
                   exportOptions: {
                       columns: conversionExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtConversionList", data, columnIdx);
                           }
                       }
                   }
               }
               //,
               //this button is supposed to handle column visibility
               //however it isn't working on our site
               //'colvis'
            ],
            initComplete: function () {
                $("#dtConversionList .dataTables_filter").append('<button type="button" class="clear-button" id="clear_search_button"><img width="29" height="29" src="/images/red-x.png" /></button>');
            },
            createdRow: function (row, data, index) {
                //this adds the class to every row
                $(row).addClass('single-line-height');
            },
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            }
        });
    }


    function getConversionData() {
        //filling out url for ajax
        var url = ServicePrefix + '/api/AccountExecutive/GetAEConversionList';

        //filling out settings for ajax call
        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inAccountExecutiveId": iAccountExecutiveId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                //if (data["report"]["rows"].length == 0) {
                //    console.log("no data");

                //    destroyDataTable("dtConversionList");
                //    $("#noConversionDataFound").show();

                //    return;
                //}

                populateDataTable("dtConversionList", data);
            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        }

        //ajax call
        $.ajax(url, settings);
    }

    function getRevenueList() {
        if (iAccountExecutiveId <= 0) {
            $("#noRevenueDataFound").show();
            return;
        }

        $("#noRevenueDataFound").hide();

        initializeRevenueTable();

        getRevenueData();
    }

    function initializeRevenueTable() {
        $("#dtRevenueList").DataTable({
            "dom": "Blfrtip",
            "pageLength": gDataTableDefaultRows,
            "data": [],
            "columns": [
                { "data": 'Period' },
                { "data": 'TotalRevenue' }
            ],
            "pagingType": "full_numbers",
            "buttons": [
               {
                   extend: 'csv',
                   exportOptions: {
                       columns: revenueExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtRevenueList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'excel',
                   title: revenueReportTitle,
                   exportOptions: {
                       columns: revenueExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtRevenueList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'pdf',
                   title: revenueReportTitle,
                   exportOptions: {
                       columns: revenueExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtRevenueList", data, columnIdx);
                           }
                       }
                   }
               },
               {
                   extend: 'print',
                   title: revenueReportTitle,
                   exportOptions: {
                       columns: revenueExportColumns,
                       format: {
                           header: function (data, columnIdx) {
                               return returnExportColumnHeadingTitle("dtRevenueList", data, columnIdx);
                           }
                       }
                   }
               }
               //,
               //this button is supposed to handle column visibility
               //however it isn't working on our site
               //'colvis'
            ],
            initComplete: function () {
                $("#dtRevenueList .dataTables_filter").append('<button type="button" class="clear-button" id="clear_search_button"><img width="29" height="29" src="/images/red-x.png" /></button>');
            },
            createdRow: function (row, data, index) {
                //this adds the class to every row
                $(row).addClass('single-line-height');
            },
            language: {
                //this changes search box label from Search: to Filter Results:
                search: "Filter Results:"
            },
            footerCallback: function (row, data, start, end, display) {

                //$(".rev-research-footer").show();

                var api = this.api(), data;

                // Remove the formatting to get integer data for summation
                var intVal = function (i) {
                    return typeof i === 'string' ?
                        i.replace(/[^0-9]/g, '') * 1 :
                        typeof i === 'number' ?
                        i : 0;
                };

                // Total over all pages
                var total = api
                    .column(1)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                // Total over this page
                var pageTotal = api
                    .column(1, { page: 'current' })
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0);

                // Update footer
                $(api.column(1).footer()).html(
                    pageTotal.toLocaleString('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 0
                    }) + ' ( ' + total.toLocaleString('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 0
                    }) + ' total)'
                );
            }
        });
    }


    function getRevenueData() {
        //filling out url for ajax
        var url = ServicePrefix + '/api/AccountExecutive/GetAERevenueList';

        //filling out settings for ajax call
        var settings = {
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inAccountExecutiveId": iAccountExecutiveId
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                //if (data["report"]["rows"].length == 0) {
                //    console.log("no data");

                //    destroyDataTable("dtConversionList");
                //    $("#noConversionDataFound").show();

                //    return;
                //}

                populateDataTable("dtRevenueList", data);
            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        }

        //ajax call
        $.ajax(url, settings);
    }

    function destroyDataTable(tableName) {

        if ($.fn.DataTable.isDataTable('#' + tableName)) {
            var searchTable = $('#dtResults').DataTable();
            searchTable.destroy();
            $('#dtResults').hide();
        }

    }


</script>