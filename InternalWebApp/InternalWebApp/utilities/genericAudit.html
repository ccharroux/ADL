<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>MKA Internal Media Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700,900' rel='stylesheet' type='text/css'>

    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="/css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="/css/icomoon.css">
    <!-- Simple Line Icons -->
    <link rel="stylesheet" href="/css/simple-line-icons.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.2/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- Modernizr JS -->
    <script src="/js/modernizr-2.6.2.min.js"></script>

    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->

    <style>
        .rptView {
            margin-left: 5px;
            vertical-align: top;
            display: inline-block;
        }

        .rptStartDate, .rptEndDate {
            /*max-width:100px;*/
            text-align: center;
        }

        .container {
            width: 100% !important;
        }

        .requiredText {
            color: red !important;
        }

        .rptButton {
            vertical-align: top;
            display: inline-block;
            float: right;
        }
    </style>

</head>
<body>


    <div id="fh5co-page">
        <header id="fh5co-header" role="banner">
            <div class="container">
                <div class="header-inner" id="menu"></div>
            </div>
        </header>
        <div id="fh5co-contact-section" class="contact-section">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-md-offset-3 text-center fh5co-heading">
                        <h2 id="reportTitle"></h2>
                    </div>
                </div>
                <div id="divQuickReport" style="float:right;padding-right:0px;padding-bottom:0px;margin-top:-100px">
                    <label for="ddlQuickReport" class="search-ddl-label" style="text-align:right">Reports:&nbsp;</label>
                    <select class="search-ddl-select" onchange="getQuickReport(this.value)" style="width:207px;font-size:14px" id="ddlQuickReport"></select>
                </div>
                <!-- search / filter area -->
                <div class="row search-section">
                    <div class="col-md-12 ">
                        <!--
                        market
                        media code
                        media type (only has newspaper and television)
                        advertiser name
                        station advertiser name
                        market advertiser name
                        media advertiser name

                        parent advertiser
                        industry
                        sub industry

                        agency name
                        station agency name
                        market agency name
                        ownership

                        parent agency

                        revenue research
                        need radio button set with newspaper, television or both (media research)
                        from date
                        to date

                        -->
                        <div class="form-group rptView auditProduct">
                            <label for="ddlProduct" class="dropdown-label rptView auditProduct">Product</label>
                            <select id="ddlProduct" apiInput="inProductId" class="dropdown-select rptView auditProduct"></select>
                        </div>
                        <div class="form-group rptView auditMarket">
                            <label for="ddlMarket" class="dropdown-label rptView auditMarket">Market</label>
                            <select id="ddlMarket" apiInput="inMarketId" class="dropdown-select rptView auditMarket"></select>
                        </div>
                        <div class="form-group rptView auditMediaCode">
                            <label for="ddlMediaCode" class="dropdown-label rptView auditMediaCode">Media Code</label>
                            <select id="ddlMediaCode" apiInput="inMediaCodeId" class="dropdown-select rptView auditMediaCode"></select>
                        </div>
                        <div class="form-group rptView auditMediaType">
                            <label for="ddlMediaType" class="dropdown-label rptView auditMediaType">Media Type</label>
                            <select id="ddlMediaType" apiInput="inMediaTypeId" class="dropdown-select rptView auditMediaType"></select>
                        </div>
                        <div class="form-group rptView auditAdvertiserName">
                            <label for="txtAdvertiserName" class="dropdown-label rptView auditAdvertiserName">Advertiser Name </label>
                            <input type="text" id="txtAdvertiserName" apiInput="inAdvertiserName" class="dropdown-label rptView auditAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditStationAdvertiserName">
                            <label for="txtStationAdvertiserName" class="dropdown-label rptView auditStationAdvertiserName">Station Advertiser Name </label>
                            <input type="text" id="txtStationAdvertiserName" apiInput="inStationAdvertiserName" class="dropdown-label rptView auditStationAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditMediaAdvertiserName">
                            <label for="txtMediaAdvertiserName" class="dropdown-label rptView auditMediaAdvertiserName">Media Advertiser Name </label>
                            <input type="text" id="txtMediaAdvertiserName" apiInput="inMediaAdvertiserName" class="dropdown-label rptView auditMediaAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditAgencyName">
                            <label for="txtAgencyName" class="dropdown-label rptView auditAgencyName">Agency Name </label>
                            <input type="text" id="txtAgencyName" apiInput="inAgencyName" class="dropdown-label rptView auditAgencyName" />
                        </div>
                        <div class="form-group rptView auditStationAgencyName">
                            <label for="txtStationAgencyName" class="dropdown-label rptView auditStationAgencyName">Station Agency Name </label>
                            <input type="text" id="txtStationAgencyName" apiInput="inStationAgencyName" class="dropdown-label rptView auditStationAgencyName" />
                        </div>
                        <div class="form-group rptView auditMarketAdvertiserName">
                            <label for="txtMarketAdvertiserName" class="dropdown-label rptView auditMarketAdvertiserName">Market Advertiser Name </label>
                            <input type="text" id="txtMarketAdvertiserName" apiInput="inMarketAdvertiserName" class="dropdown-label rptView auditMarketAdvertiserName" />
                        </div>
                        <div class="form-group rptView auditMarketAgencyName">
                            <label for="txtMarketAgencyName" class="dropdown-label rptView auditMarketAgencyName">Market Agency Name </label>
                            <input type="text" id="txtMarketAgencyName" apiInput="inMarketAgencyName" class="dropdown-label rptView auditMarketAgencyName" />
                        </div>
                        <div class="form-group rptView auditIndustry">
                            <!-- industry -->
                            <label for="ddlIndustry" class="dropdown-select rptView auditIndustry">Industry</label>
                            <select id="ddlIndustry" apiInput="inIndustryId" class="dropdown-select rptView auditIndustry"></select>
                        </div>
                        <div class="form-group rptView auditSubIndustry">
                            <!-- subindustry -->
                            <label for="ddlSubIndustry" class="dropdown-select rptView auditSubIndustry">Sub Industry</label>
                            <select id="ddlSubIndustry" apiInput="inSubIndustryId" class="dropdown-select rptView auditSubIndustry"></select>
                        </div>
                        <div class="form-group rptView auditParentAdvertiser">
                            <!-- parent advertiser -->
                            <label for="ddlParentAdvertiser" class="dropdown-select rptView auditParentAdvertiser">Parent Advertiser</label>
                            <select id="ddlParentAdvertiser" apiInput="inParentAdvertiserId" class="dropdown-select rptView auditParentAdvertiser"></select>
                        </div>
                        <div class="form-group rptView auditParentMarket">
                            <label for="ddlParentMarket" class="dropdown-label rptView auditParentMarket">Parent Market</label>
                            <select id="ddlParentMarket" apiInput="inParentMarketId" class="dropdown-select rptView auditParentMarket"></select>
                        </div>
                        <div class="form-group rptView auditParentAgency">
                            <label for="ddlParentAgency" class="dropdown-label rptView auditParentAgency">Parent Agency</label>
                            <select id="ddlParentAgency" apiInput="inParentAgencyId" class="dropdown-select rptView auditParentAgency"></select>
                        </div>
                        <!--<div class="form-group rptView auditStation">
                            <label for="ddlStation" class="dropdown-label rptView auditStation">Station</label>
                            <select id="ddlStation" apiInput="inStationId" class="dropdown-select rptView auditStation"></select>
                        </div>-->
                        <div class="form-group rptView auditOwner">
                            <label for="ddlOwner" class="dropdown-label rptView auditOwner">Owner</label>
                            <select id="ddlOwner" apiInput="inOwnerId" class="dropdown-select rptView auditOwner"></select>
                        </div>
                        <!--<div class="form-group rptView auditOwnerGroup">
                            <label for="ddlOwnerGroup" class="dropdown-label rptView auditOwnerGroup">Owner</label>
                            <select id="ddlOwnerGroup" apiInput="inOwnerGroupId" class="dropdown-select rptView auditOwnerGroup"></select>
                        </div>-->
                        <div class="form-group rptView auditAccountType">
                            <label for="ddlAccountType" class="dropdown-label rptView auditAccountType">Account Type</label>
                            <select id="ddlAccountType" apiInput="inAccountType" class="dropdown-select rptView auditAccountType"></select>
                        </div>
                        <!--<div class="form-group rptView auditPersonnel">
                            <div class="form-group" style="display: table-cell;">
                                <label for="hidPersonnel" class="dropdown-label rptView auditPersonnel">Personnel</label>
                                <input type="text" id="txtPersonnel" onclick="getPersonnel()" readonly class="dropdown-select rptView auditPersonnel"/>
                                <a class="rptView auditPersonnel" href="#" onclick="clearSelection('Personnel')">X</a>
                                <input type="hidden" id="hidPersonnel" apiInput="inPersonnelId" class="dropdown-select rptView auditPersonnel"/>
                            </div>

                        </div>-->
                        <!--<div class="form-group rptView auditYear">
                            <label for="ddlYear" class="dropdown-label rptView auditYear">Year</label>
                            <select id="ddlYear" apiInput="inYear" class="dropdown-select rptView auditYear"></select>
                        </div>
                        <div class="form-group rptView auditPeriod">
                            <label for="ddlPeriod" class="dropdown-label rptView auditPeriod">Period</label>
                            <select id="ddlPeriod" apiInput="inPeriod" class="dropdown-select rptView auditPeriod"></select>
                        </div>-->
                        <div class="form-group auditStartDate rptView">
                            <label for="dtStartDate" class="dropdown-label auditStartDate rptView">Start Date</label>
                            <input type="text" id="dtStartDate" class="auditStartDate rptView" style="max-width: 100px;" apiInput="inStartDate">
                        </div>
                        <div class="form-group auditEndDate rptView">
                            <label for="dtEndDate" class="dropdown-label auditEndDate rptView">End Date</label>
                            <input type="text" id="dtEndDate" class="auditEndDate rptView" style="max-width: 100px;" apiInput="inEndDate">
                        </div>

                        <div class="form-group col-md-3 rptButton" style="text-align: right">
                            <label for="btnReport" class="dropdown-label">&nbsp;</label>
                            <input type="button" id="btnReport" class="search-button" value="Show" onclick="getReport()" />
                        </div>

                    </div>
                </div>

                <!-- start datatable coding-->

                <div class="dataTable-top-margin">
                    <table id="dtResults" class="stripe"></table>
                    <div id="noDataFound" style="display:none; color: red">No data found</div>
                </div>

                <!-- end datatable coding-->

            </div>
        </div>
    </div>


    <!-- jQuery -->
    <script src="/js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="/js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!-- Waypoints -->
    <script src="/js/jquery.waypoints.min.js"></script>
    <!-- BlockUI JS -->
    <script src="/js/blockUI.js"></script>
    <!-- Config JS -->
    <script src="/js/config.js"></script>
    <!-- MAIN JS -->
    <script src="/js/main.js"></script>
    <!-- genericReport JS -->
    <script src="/js/genericAudit.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</body>
</html>
<script>

    var auditObject = new Object();
    var reportFilterArray = new Array();

    var api = "";
    var apiParameters = new Object();
    var apiToken = "";
    var searchText = "";
    var columns = [];
    var columnsToDisplay = new Array();
    var columnsToExport = new Array();
    var reportId = 0;

    var startDate = "";
    var endDate = "";

    $(document).ready(function () {

        //var outReportArray = buildReportArray();
        //console.log(outReportArray);


        LoadDefaultDates();

        reportId = getParameterByName("reportId");

        if (!reportId) {
            var msg = "Invalid page request, no report passed.";
            bootbox.alert(msg, function () { window.location = "/dashboard.html"; });
            return false;
        }

        // setup date pickers
        $(function () {
            $("#dtStartDate").datepicker();
            $("#dtEndDate").datepicker();
        });


        // get report objects
        auditObject = getAuditObject(reportId);
        reportFilterArray = auditObject.filters;
       
        if (auditObject.apiControllerAction == null) {
            var msg = "Invalid report requested. (2)";

            bootbox.alert(msg, function () { window.location = "/dashboard.html"; });

            return false;
        }

        // report title
        //console.log(auditObject);
        $("#reportTitle").html(auditObject.auditTitle);

        // clear
        $("body").on("click",
            "#clear_search_button",
            function () {
                var table = $("#dtAgencyList").DataTable();
                table.search('').draw();
            });

        // build menu
        buildXRYMenu("Audits");
        buildQuickReports(auditObject.product);

        // display filters
        displayFilters(reportFilterArray);

        loadOnChangeEvents(reportFilterArray);

        // Auto Run
        if (reportFilterArray.length == 0) {
            getReport();
            $("#btnReport").hide();
        }
        else {
            $("#btnReport").show();
            loadAdvancedSearch();
        }

    });

    function clearSelection(control) {
        $("#txt" + control).val("");
        $("#hid" + control).val("");
    }

    function loadAdvancedSearch() {

        var searchResults = getLocalStorage("gSearchResults");


        if (!searchResults) {
            return;
        }

        var searchCriteria = $.parseJSON(searchResults);

        if (searchCriteria["searchToken"] == "PERSONNEL") {

            // load newly found data
            $("#txtPersonnel").val(searchCriteria["txtPersonnel"]);
            $("#hidPersonnel").val(searchCriteria["personnelId"]);

            // clear out the storage
            searchCriteria["txtPersonnel"] = "";
            searchCriteria["personnelId"] = "";

            // save it
            setLocalStorage("gSearchResults", JSON.stringify(searchCriteria));


            $("#ddlMarket").val(searchCriteria["ddlMarket"]);
            $("#ddlOwner").val(searchCriteria["ddlOwner"]);
        }

    }

    function preSelectItem(whatToCheckFor) {
        var preSelectedValue = getLocalStorage(whatToCheckFor);

        if (!preSelectedValue) {
            return;
        }
        var preSelectedArray = preSelectedValue.split("|");

        if (preSelectedArray.length < 2) {
            return;
        }

        $("#" + preSelectedArray[0]).val(preSelectedArray[1]);
        setTimeout(getReport, 1000);
    }

    function saveLoadedControlSelection(control) {
        var searchResults = getLocalStorage("gSearchResults");

        if (!searchResults) {
            return;
        }

        var searchCriteria = $.parseJSON(searchResults);
        $("#" + control).val(searchCriteria[control]);

    }

    function LoadDefaultDates() {
        var d = new Date();
        var currentMonth = d.getMonth() + 1;
        var currentYear = d.getFullYear();
        var lastDayOfTheMonth = new Date(d.getFullYear(), d.getMonth() + 1, 0);

        $("#dtStartDate").val(currentMonth + "/01/" + currentYear);
        $("#dtEndDate").val(currentMonth + "/" + lastDayOfTheMonth.getDate() + "/" + currentYear);

        saveLoadedControlSelection("dtStartDate");
        saveLoadedControlSelection("dtEndDate");

    }

    function displayFilters(arrayFilters) {

        // set all filters display to none
        $(".rptView").hide();

        for (var i = 0; i < arrayFilters.length; i++) {

            activateFilter(arrayFilters[i]);
            if (arrayFilters[i].required == true) {

                var input = $("#" + arrayFilters[i].objectName);
                $("label[for=" + input.attr("id") + "]").css("color", "red");
                $("label[for=" + input.attr("id") + "]").prepend(" * ");

            }
        }

    }

    function activateFilter(filterObject) {

        var classToShow = "audit" + filterObject.token;
        $("." + classToShow).show();

        if (filterObject.jsCall == null) {
            return;
        }

        window[filterObject.jsCall]();
    }

    //--------------------------------
    // Filters get loaded here
    //--------------------------------
    function getYearList() {
        var str = '';
        str = '<option value="">-- Select a Year --</option>';

        var thisYear = (new Date()).getFullYear();

        for (var i = thisYear; i > (thisYear - 10) ; i--) {

            str = str + '<option value="' + i + '">' + i + '</option>';
        }

        $("#ddlYear").html(str);
        saveLoadedControlSelection("ddlYear");
    }

    function getXRYMediaCodeList() {
        $.ajax({
            url: ServicePrefix + '/api/MediaCode/GetMediaCodeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Media Code --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].mediaCodeId + '">' + data.report.rows[index].mediaCodeDescription + '</option>';

                    });

                    $("#ddlMediaCode").html(str);
                    saveLoadedControlSelection("ddlMediaCode");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getMediaTypeList() {

        $.ajax({
            url: ServicePrefix + '/api/MediaType/GetMediaTypeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Media Type --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].MediaTypeID + '">' + data.report.rows[index].MediaTypeName + '</option>';

                    });

                    $("#ddlMediaType").html(str);
                    saveLoadedControlSelection("ddlMediaType");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    function getMediaAdvertiserMediaTypeList() {

        $.ajax({
            url: ServicePrefix + '/api/MediaAdvertiser/GetMediaAdvertiserMediaTypeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Media Type --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].mediaTypeId + '">' + data.report.rows[index].mediaType + '</option>';

                    });

                    $("#ddlMediaType").html(str);
                    saveLoadedControlSelection("ddlMediaType");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    function getIndustryList() {
        $.ajax({
            url: ServicePrefix + '/api/Industry/GetIndustryList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="-1">-- Select an Industry --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].industryId + '">' + data.report.rows[index].industryName + '</option>';

                    });

                    $("#ddlIndustry").html(str);
                    saveLoadedControlSelection("ddlIndustry");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    ////function getSubIndustryList() {

    ////    var loadSubIndustryForIndustry = getPropertyObjectByToken("industry");

    ////    if (loadSubIndustryForIndustry.loadSubIndustry === false ||
    ////        $("#ddlIndustry").val() == "-1") {

    ////        $("#ddlSubIndustry").empty();
    ////        return;
    ////    }

    ////    $.ajax({
    ////        url: ServicePrefix + '/api/SubIndustry/GetSubIndustryList',
    ////        dataType: 'json',
    ////        type: 'post',
    ////        contentType: 'application/json',
    ////        data: JSON.stringify({
    ////            "inApiToken": getLocalStorage("APIToken"),
    ////            "inIndustryId": $("#ddlIndustry").val()
    ////        }),
    ////        processData: false,
    ////        success: function (data, textStatus, jQxhr) {

    ////            if (data.response.status != "SUCCESS") {
    ////                MKAErrorMessageRtn(data.response.errorMessage[0]);
    ////            }
    ////            else {

    ////                var str = '';
    ////                str = '<option value="-1">-- Select a Sub Industry --</option>';
    ////                $.each(data.report.rows, function (index) {

    ////                    str = str + '<option value="' + data.report.rows[index].subIndustryId + '">' + data.report.rows[index].subIndustryName + '</option>';

    ////                });

    ////                $("#ddlSubIndustry").html(str);
    ////                saveLoadedControlSelection("ddlSubIndustry");

    ////            }


    ////        },
    ////        error: function (jqXhr, textStatus, errorThrown) {
    ////            genericAjaxError(jqXhr, textStatus, errorThrown);
    ////        }
    ////    });
    ////}

    function getParentAdvertiserList() {
        $.ajax({
            url: ServicePrefix + '/api/ParentAdvertiser/GetParentAdvertiserList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Parent Advertiser --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].parentAdvertiserId + '">' + data.report.rows[index].parentAdvertiserName + '</option>';

                    });

                    $("#ddlParentAdvertiser").html(str);
                    saveLoadedControlSelection("ddlParentAdvertiser");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getParentAgencyList() {
        $.ajax({
            url: ServicePrefix + '/api/ParentAgency/GetParentAgencyList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Parent Agency --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].parentAgencyId + '">' + data.report.rows[index].parentAgencyName + '</option>';

                    });

                    $("#ddlParentAgency").html(str);
                    saveLoadedControlSelection("ddlParentAgency");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getAccountTypeList() {
        $.ajax({
            url: ServicePrefix + '/api/AccountType/GetAccountTypeList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select an Account Type --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].accountTypeId + '">' + data.report.rows[index].accountTypeName + '</option>';

                    });

                    $("#ddlAccountType").html(str);
                    saveLoadedControlSelection("ddlAccountType");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getPersonnel() {


        var searchCriteriaObj = {
            "searchToken": "PERSONNEL",
            "ddlProduct": $("#ddlProduct").val(),
            "ddlMarket": $("#ddlMarket").val(),
            "ddlStation": $("#ddlStation").val(),
            "ddlOwner": $("#ddlOwner").val(),
            "ddlYear": $("#ddlYear").val(),
            "ddlPeriod": $("#ddlPeriod").val(),
            "dtStartDate": $("#dtStartDate").val(),
            "dtEndDate": $("#dtEndDate").val(),
            "txtPersonnel": $("#txtPersonnel").html(),
            "searchPage": window.location
        }

        setLocalStorage("gSearchCriteria", JSON.stringify(searchCriteriaObj));

        window.location = "/utilities/search.html";
    }

    function getPeriodListQuarters() {
        getPeriodList("quarters");
    }

    function getPeriodListMonths() {
        getPeriodList("months");
    }

    function getParentMarketList() {
        $.ajax({
            url: ServicePrefix + '/api/ParentMarket/GetParentMarketList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Parent Market --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].parentMarketId + '">' + data.report.rows[index].parentMarketName + '</option>';

                    });

                    $("#ddlParentMarket").html(str);
                    saveLoadedControlSelection("ddlParentMarket");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getPeriodList(typesToLoad) {

        if (!typesToLoad) {
            typesToLoad = "all";
        }

        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        var str = '';
        str = '<option value="">-- Select a Period --</option>';

        if (typesToLoad.toLowerCase() == "all" || typesToLoad.toLowerCase() == "months") {

            for (var i = 1; i <= 12; i++) {

                str = str + '<option value="' + (i < 10 ? '0' + i.toString() : i.toString()) + '">' + monthNames[i - 1] + '</option>';
            }
        }

        if (typesToLoad.toLowerCase() == "all") {
            str = str + '<option value="">-----------</option>';
        }

        if (typesToLoad.toLowerCase() == "all" || typesToLoad.toLowerCase() == "quarters") {
            for (var i = 1; i <= 4; i++) {

                str = str + '<option value="Q' + i.toString() + '">Quarter - ' + i.toString() + '</option>';
            }
        }


        $("#ddlPeriod").html(str);
        saveLoadedControlSelection("ddlPeriod");
    }

    function getProductList() {

        $.ajax({
            url: ServicePrefix + '/api/Product/GetProductList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Product --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].P_ProductID + '">' + data.report.rows[index].P_ProductName + '</option>';

                    });

                    $("#ddlProduct").html(str);
                    saveLoadedControlSelection("ddlProduct");
                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    function getStationList() {

        $.ajax({
            url: ServicePrefix + '/api/Station/GetStationList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inActiveOnly": "1"
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Station --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].stationId + '">' + data.report.rows[index].stationName + '</option>';

                    });

                    $("#ddlStation").html(str);
                    saveLoadedControlSelection("ddlStation");

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    function getXRYMarketList() {
        getMarketList('XRY');
    }
    function getMRRMarketList() {
        getMarketList('MRR');
    }
    function getMSSMarketList() {
        getMarketList('MSS');
    }
    function getTVBMarketList() {
        getMarketList('TVB');
    }
    function getDMAMarketList() {
        getMarketList('DMA');
    }

    function getMarketListAll() {
        $.ajax({
            url: ServicePrefix + '/api/Market/GetMarketList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken")
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Market --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].marketId + '">' + data.report.rows[index].marketName + '</option>';

                    });

                    $("#ddlMarket").html(str);
                    saveLoadedControlSelection("ddlMarket");
                    preSelectItem('quickReportQS');

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function getMarketList(inProduct) {

        $.ajax({
            url: ServicePrefix + '/api/Market/GetMarketListByProduct',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inProductId": inProduct,
                "inActiveOnly ": true
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    var str = '';
                    str = '<option value="">-- Select a Market --</option>';
                    $.each(data.report.rows, function (index) {

                        str = str + '<option value="' + data.report.rows[index].marketId + '">' + data.report.rows[index].marketName + '</option>';

                    });

                    $("#ddlMarket").html(str);
                    saveLoadedControlSelection("ddlMarket");
                    preSelectItem('quickReportQS');

                }


            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }

    ////function getOwnerListByProductMarket() {

    ////    //need to build another api to get by marketid
    ////    //look at using property from reportFilterArray
    ////    //do the same thing for subindustry on the industry ddl

    ////    var loadOwnerForMarket = getPropertyObjectByToken("market");

    ////    if (loadOwnerForMarket.loadOwnerList === false ||
    ////        $("#ddlMarket").val() == "") {

    ////        $("#ddlOwner").empty();
    ////        return;
    ////    }

    ////    $.ajax({
    ////        url: ServicePrefix + '/api/Owner/GetOwnerListByProductMarket',
    ////        dataType: 'json',
    ////        type: 'post',
    ////        contentType: 'application/json',
    ////        data: JSON.stringify({
    ////            "inApiToken": getLocalStorage("APIToken"),
    ////            "inProductId": "XRY",
    ////            "inMarketId": $("#ddlMarket").val()
    ////        }),
    ////        processData: false,
    ////        success: function (data, textStatus, jQxhr) {

    ////            if (data.response.status != "SUCCESS") {
    ////                MKAErrorMessageRtn(data.response.errorMessage[0]);

    ////            }
    ////            else {

    ////                var str = '';

    ////                $("#ddlOwner").html("<option value='-1'> -- Select an Owner --</option>");

    ////                var holdOwnerID = "0";

    ////                $.each(data.report.rows, function (index) {
    ////                    var obj = data.report.rows[index];
    ////                    str = str + "<option value='" + obj.ownerid + "'>" + obj.ownername + "</option>";

    ////                });

    ////                $("#ddlOwner").append(str);
    ////                saveLoadedControlSelection("ddlOwner");
    ////            }

    ////        },
    ////        error: function (jqXhr, textStatus, errorThrown) {
    ////            genericAjaxError(jqXhr, textStatus, errorThrown);
    ////        }
    ////    });

    ////}

    function getOwnerGroupList() {

        $.ajax({
            url: ServicePrefix + '/api/OwnerGroup/GetOwnerGroupList',
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({
                "inApiToken": getLocalStorage("APIToken"),
                "inIncludeNationwide": true
            }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                    MKAErrorMessageRtn(data.response.errorMessage[0]);

                }
                else {

                    var str = '';

                    $("#ddlOwnerGroup").html("<option value=''> -- Select an Owner Group --</option>");

                    var holdOwnerID = "0";

                    $.each(data.report.rows, function (index) {
                        var obj = data.report.rows[index];
                        str = str + "<option value='" + obj.OG_OwnerGroupID + "'>" + obj.OG_OwnerGroupName + "</option>";

                    });

                    $("#ddlOwnerGroup").append(str);
                    saveLoadedControlSelection("ddlOwnerGroup");
                }

            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });

    }
    //--------------------------------
    // Filters get loaded end here
    //--------------------------------

    //////----------------------
    ////// BEGIN: load of the reports and supporting routines
    //////---------------------
    function getReport() {

        $("#noDataFound").hide();

        console.log(auditObject);

        api = auditObject.apiControllerAction;
        apiParameters = new Object();
        apiToken = getLocalStorage("APIToken");
        searchText = "";
        columns = [];

        //------------------------
        //setup the parameters for the API
        //------------------------

        if (auditObject.apiType.toLowerCase() == "post") {
            apiParameters["inApiToken"] = apiToken;
        }
        else {
            api = api + "?inApiToken=" + apiToken;
        }

        //------------------------
        // loop thru filters
        //------------------------
        var itemsToCheckLength = reportFilterArray.length;

        //-------------------------------
        // This is the no filter use case
        //-------------------------------
        if (itemsToCheckLength == 0) {
            getTheReportAJAX();
            return;
        }

        $.each(reportFilterArray, function (objectName, objectValue) {
            var control = objectValue.objectName;


            var nameOfParm = $("#" + control).attr("apiInput");
            var item = "#" + control;
            var isRequired = objectValue.required;

            //if ($(item).prop("tagName") == "SELECT") {

            if ($(item).val() != "") {
                if (auditObject.apiType.toLowerCase() == "post") {
                    apiParameters[nameOfParm] = $(item).val();
                }
                else {
                    api = api + "&" + nameOfParm + "=" + $(item).val();
                }

            }
            else {
                if (isRequired) {
                    var msg = "Please select a " + nameOfParm.toLowerCase().replace("in", "").replace("id", "");
                    bootbox.alert(msg, function () { });
                    return false;
                }
            }

            // when done with the loop
            // get the report
            if (objectName == (itemsToCheckLength - 1)) {

                getTheReportAJAX();
            }

        });
    }

    function getTheReportAJAX() {

        $.ajax({
            url: ServicePrefix + api,
            dataType: 'json',
            type: auditObject.apiType.toString().toLowerCase(),
            contentType: 'application/json',
            data: JSON.stringify(apiParameters),
            processData: false,
            success: function (data, textStatus, jQxhr) {
                if (data.response.status.toUpperCase() === "SUCCESS") {

                    buildColumnsArray(data);

                }
                else {
                    var msg = data.response.errorMessage[0];
                    bootbox.alert(msg, function () { });
                    return false;
                }
            },
            error: function (jqXhr, textStatus, errorThrown) {
                genericAjaxError(jqXhr, textStatus, errorThrown);
            }
        });
    }

    function destroyDataTable() {
        if ($.fn.DataTable.isDataTable('#dtResults')) {
            var searchTable = $('#dtResults').DataTable();
            searchTable.destroy();
            $('#dtResults').hide();
        }

    }

    function buildColumnsArray(dataObj) {
        columnsToExport = new Array();

        if (!dataObj["report"]["rows"]) {
            destroyDataTable();
            $("#noDataFound").show();

            return;
        }

        if (dataObj["report"]["rows"].length == 0) {
            destroyDataTable();
            $("#noDataFound").show();
            return;
        }
        $('#dtResults').show();

        var data = dataObj["report"]["rows"][0];
        var ctr = -1;

        $.each(data, function (objectName, objectValue) {

            //console.log("object name: " + objectName + " object value: " + objectValue);
            //console.log(auditObject.columnsToDisplay);

            if (auditObject.columnsToDisplay.length == 0 ||
                IsInArray(auditObject.columnsToDisplay, objectName) == true) {

                var className = "";


                if (objectValue === null) {

                    className = "";
                } else {

                    if ((isNaN(objectValue) == false)) {


                        if (objectValue.toString().length > 0) {
                            className = "text-align-right";

                        }
                    } else {
                        className = "";
                    }
                }


                ctr++;
                columnsToExport.push(ctr);


                var bSortable = true;
                if (auditObject.sortable == 'undefined') {
                    bSortable = true;

                } else {
                    bSortable = auditObject.sortable;
                }


                columns.push({
                    "title": objectName,
                    "visible": true,
                    "mData": objectName,
                    "orderable": bSortable,
                    "className": className
                });
            }

        });

        //find the object in the columns that have any actions
        //created an array of possible actions in genericAudit.js
        //currently there is only edit
        //if the action is found, the column will be added to the table.
        //this has to be done after the fact since these columns do not come back
        //in the data.
        for (var i = 0; i < auditActionsArray.length; i++) {
            var actionIndex = GetActionColumnIndex(auditObject, auditActionsArray[i]);
            //a -1 means the item wasn't found in the array
            if (actionIndex > -1) {
                columns.push(auditObject.columnsToDisplay[actionIndex]);
            }
        }

        loadResults(dataObj, columns);
    }

    function GetActionColumnIndex(auditObject, actionName) {
        return auditObject.columnsToDisplay.map(
            function (x) {
                return x.action;
            }).indexOf(actionName);
    }

    function IsInArray(arrayToSearch, valToFind) {
        for (var i = 0; i < arrayToSearch.length; i++) {
            if (arrayToSearch[i].toLowerCase() == valToFind.toLowerCase()) {
                return true;
            }
        }
        return false;
    }

    function loadResults(data, columns) {
        //data is the data from the ajax call
        //columns is the array that was built previously

        //assigns the data from the ajax call
        var results = data["report"]["rows"];

        //creating a variable that will used for datatable functions later
        var searchTable;

        //if the datatable already exists need to destroy it before building it
        //again with new results from the search.
        //if you try to destroy before it is a datatable, an error will occur.
        //this code will only destroy it if the table is a datatable.
        if ($.fn.DataTable.isDataTable('#dtResults')) {
            searchTable = $('#dtResults').DataTable();
            searchTable.destroy();
        }

        //this code rebuilds the datatable with the updated data from the search
        //or initial load.


        searchTable = $("#dtResults").DataTable({
            "dom": "Blfrtip",
            "pageLength": gDataTableDefaultRows,
            "order": [],
            "data": results,
            "columns": columns,
            "select": true,
            language: {
                search: "Filter Results:"
            },
            "buttons": [
               //{
               //    extend: 'csv',
               //    exportOptions: {
               //        columns: columnsToExport
               //    }
               //},
               {
                   extend: 'excel',
                   title: auditObject.reportTitle,
                   exportOptions: {
                       columns: columnsToExport
                   }
               },
               //{
               //    extend: 'pdf',
               //    title: auditObject.reportTitle,
               //    exportOptions: {
               //        columns: columnsToExport
               //     }
               //},
               {
                   extend: 'print',
                   title: auditObject.reportTitle,
                   exportOptions: {
                       columns: columnsToExport

                   }
               }
            ]
        });

    }
    //----------------------
    // END: load of the reports and supporting routines
    //---------------------

    //--------------------
    // misc
    //--------------------
    function loadLastSearch() {
        var search = getParameterByName("search");

        if (!search == false) {
            if (search.length > 0) {

                var sArray = new Array();
                sArray = search.split("|");

                $("#searchText").val(sArray[0]);
                $("#ddlMarket").val(sArray[1].toString());

                getAgencyList();
            }
        }

    }

    //this function takes in a page location and an id
    //if there needs to be more than page parameter
    //this function will need to be modified
    //this will direct to the proper page and id for editing, etc.
    function loadActionPage(pageLocation, itemId) {
        window.location = pageLocation + itemId;
    }

    function getPropertyObjectByToken(token) {
        for (var i = 0; i < reportFilterArray.length - 1; i++) {
            if (reportFilterArray[i].token.toLowerCase() == token.toLowerCase()) {
                return reportFilterArray[i];
            }
        }
    }

    function loadOnChangeEvents(reportFilterArray) {

        for (var i = 0; i < reportFilterArray.length - 1; i++) {

            if (reportFilterArray[i].onchange != "undefined") {

                $("#" + reportFilterArray[i].objectName).change(reportFilterArray[i].onchange);

            }
        }
    }

</script>
