<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <title></title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ADL System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="../../favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700,900' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="../../css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="../../css/icomoon.css">
    <!-- Simple Line Icons -->
    <link rel="stylesheet" href="../../css/simple-line-icons.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.2/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" />

    <!--Chosen Dropdown-->
    <link rel="stylesheet" href="../../css/chosen.min.css" />
    <!-- Modernizr JS -->
    <script src="../../js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->

</head>
<body>
    <div id="fh5co-page">
        <header id="fh5co-header" role="banner">
            <div class="container">
                <div class="header-inner" id="menu"></div>
            </div>
        </header>
        <input type="hidden" id="patientAccess" value="true" />
        <div id="fh5co-contact-section" class="contact-section">
            <div class="container">

                <div class="row">
                    <div class="col-md-6 col-md-offset-3 text-center fh5co-heading">
                        <h2 id="pageTitle"></h2>
                    </div>
                </div>

                <div class="text-center margin-top-0">


                    <!--First Name-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtFirstName">First Name</label>
                        </div>
                        <div class="col-md-5 text-align-left">
                            <input type="text" class="dataIsRequired field-width-325" id="txtFirstName" maxlength="35" errorMessage="You must enter a First Name." />
                        </div>
                        <div class="col-md-2 text-align-center">
                            <div class="gray-label width-130">
                                <span id="spnWebStatus"></span>
                            </div>
                        </div>
                    </div>
                    <!--Middle Name-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtMiddleName">Middle Name</label>
                        </div>
                        <div class="col-md-5 text-align-left">
                            <input type="text" class="field-width-325" id="txtMiddleName" maxlength="35" />
                        </div>
                        <div class="col-md-2 text-align-center">
                            <div class="gray-label width-130">
                                <span id="spnWebStatus"></span>
                            </div>
                        </div>
                    </div>
                    <!--Last Name-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtLastName">Last Name</label>
                        </div>
                        <div class="col-md-5 text-align-left">
                            <input type="text" class="dataIsRequired field-width-325" id="txtLastName" maxlength="35" errorMessage="You must enter a Last Name." />
                        </div>
                        <div class="col-md-2 text-align-center">
                            <div class="gray-label width-130">
                                <span id="spnWebStatus"></span>
                            </div>
                        </div>
                    </div>

                    <!--Email Address-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtEmailAddress">Email Address</label>
                        </div>
                        <div class="col-md-5 text-align-left">
                            <input type="text" class="dataIsRequired field-width-325" id="txtEmailAddress" maxlength="35" errorMessage="You must enter an Email Address." />
                        </div>
                        <div class="col-md-2 text-align-center">
                            <div class="gray-label width-130">
                                <span id="spnWebStatus"></span>
                            </div>
                        </div>
                    </div>
                    <!--Phone Number-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtPhoneNumber">Phone Number</label>
                        </div>
                        <div class="col-md-5 text-align-left">
                            <input type="text" class="dataIsRequired field-width-325" id="txtPhoneNumber" maxlength="35" errorMessage="You must enter a Phone Number." />
                        </div>
                        <div class="col-md-2 text-align-center">
                            <div class="gray-label width-130">
                                <span id="spnWebStatus"></span>
                            </div>
                        </div>
                    </div>
                    <!--Address1-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtAddress1">Address</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input type="text" maxlength="30" id="txtAddress1" errorMessage="You must enter an Address." class="dataIsRequired field-width-325" />
                        </div>
                    </div>

                    <!--Address2-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input type="text" maxlength="30" id="txtAddress2" class="field-width-325" />
                        </div>
                    </div>

                    <!--City-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtCity">City</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input type="text" maxlength="25" id="txtCity" errorMessage="You must enter a City." class="dataIsRequired field-width-325" />
                        </div>
                    </div>

                    <!--State-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="ddlState">State</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <select id="ddlState" class="dataIsRequired field-width-325"  errorMessage="You must select a State."></select>
                        </div>
                    </div>

                    <!--ZipCode-->
                    <div class="row input-row">
                        <div class="col-md-3 text-align-left">
                            <label for="txtZipCode">Zipcode</label>
                        </div>
                        <div class="col-md-9 text-align-left">
                            <input type="text" id="txtZipCode" maxlength="10" class="dataIsRequired" errorMessage="You must enter a Zip Code." size="10" />
                        </div>
                    </div>

                    <!--Buttons-->
                    <div class="default-button-section">
                        <div class="row">
                            <div class="col-md-12">
                                <div>
                                    <input value="Update" onclick="updateUser();" class="default-button" type="button" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="patientForm" style="display:none" class="default-button-section">
                        <div class="row">
                            <div class="col-md-12 text-align-center">
                                    <center><h3 style="margin-bottom:10px;">Patient Forms</h3>
                                    <table style="margin-bottom:10px;width:50%">
                                        <tr>
                                            <td  width="60%"  class="text-align-left">
                                                Total Forms
                                            </td>
                                            <td width="40%"  id="divTotalForms" class="text-align-center">

                                            </td>
                                        </tr>
                                        <tr>
                                            <td width="60%" class="text-align-left">
                                                Total Signed Forms
                                            </td>
                                            <td id="divTotalSigned" width="40%" class="text-align-center">

                                            </td>
                                        </tr>  
                                    </table>
                                </center>
                            </div>
                        </div>
                            
                        <div class="row">
                            <div class="col-md-12">
                                <div>
                                    <input value="View Patient Forms" onclick="goToPatientForms();" class="default-button" type="button" />
                                </div>
                                <!--<div class="back-button-div">
                                    <input value="Back" onclick="goBackToDashboard();" class="default-button" type="button" />
                                </div>-->
                            </div>
                        </div>
                    </div>
                    <div id="divAccess" style="display:none;width:100%">
                        <!--Buttons-->
                        <h3>Access</h3>

                        <!-- start datatable-->
                        <div class="dataTable-top-margin" style="width:100%">
                            <table  style="width:100%" id="dt" class="dataTable-border dataTable-headers dataTable-cell-border">
                                <thead>
                                    <tr>
                                        <th class="exportColumn">Facility</th>
                                        <th class="exportColumn">Role</th>
                                        <th></th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        <!-- end datatable -->

                        <div class="default-button-section">
                            <div class="row">
                                <div class="col-md-12">
                                    <div>
                                        <input id="btnAddRole" value="Add Role" onclick="addRole();" class="default-button" type="button" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>
                    </div>




                    <div class="default-button-section">
                        <div class="row">
                            <div class="col-md-12">
                                <div>
                                    <input value="Back to List" onclick="backToList();" class="default-button" type="button" />
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- Dialog -->
    <div id="AddAccessDialog" title="" style="display:none">
        <h3 id="patient"></h3>
        <hr>
        <div class="row input-row">
            <div class="col-md-3 text-align-left">
                <label for="ddlAccessFacility">Facility</label>
            </div>
            <div class="col-md-9 text-align-left">
                <select id="ddlAccessFacility" class="field-width-325"></select>
            </div>
        </div>
        <div class="row input-row">
            <div class="col-md-3 text-align-left">
                <label for="ddlAccessRole">Role</label>
            </div>
            <div class="col-md-9 text-align-left">
                <select id="ddlAccessRole" class="field-width-325"></select>
            </div>
        </div>
        <hr />

        <div class="row input-row">

            <div class="col-md-12 text-align-center">
                <div>
                    <input value="Add" onclick="addRoleFinalStep();" class="default-button" type="button" />
                </div>
            </div>
        
        </div>
        <div id="addAccessErrorMessage" class="errroMessage"></div>

    </div>   

    <!-- jQuery -->
    <script src="../../js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="../../js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!-- Waypoints -->
    <script src="../../js/jquery.waypoints.min.js"></script>
    <!-- BlockUI JS -->
    <script src="../../js/blockUI.js"></script>
    <!-- Config JS -->
    <script src="../../js/config.js"></script>
    <!-- MAIN JS -->
    <script src="../../js/main.js"></script>
    <!-- genericReport JS -->
    <script src="../../js/genericReport.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.print.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script>
    <!-- plug-in to abbreviate HTML -->
    <script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.20/dataRender/ellipsis.js"></script>    
    <!-- jQuery UI NEEDED FOR DIALOG -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
 
    <!--Chosen Dropdown-->
    <script src="../../js/chosen.jquery.min.js"></script>

</body>
</html>
<script>
    var patientMaintenance = false;
    var addressId = 0;
    var holdAddressId = 0;
    var userId = 0;
    var bDirty = false;
    var accessDialogControl = "AddAccessDialog";
    var bIsThisAPatient = false;
    var entryUserId = 0;
    var addOwner = false;
    var facilityId = 0;
    var assign = false;

    $(document).ready(function ()
    {
                
        // for add dialog
        getRolesList("ddlAccessRole");
        loadFacilities('ddlAccessFacility', true);

        // data for user screen
        getStateList("ddlState");


        // hide/show role button
        if (getLocalStorage("currentRole") == cSystemAdminText || 
            getLocalStorage("currentRole") == cOwnerText)
        {
            $("#btnAddRole").show();
        }
        else
        {
            $("#btnAddRole").hide();
        }

        // query string vars
        patientMaintenance = (getParameterByName("pateintMaintenance") == null ? false : true);
        assign = (getParameterByName("assign") == null ? false : Boolean(getParameterByName("assign")));
        addOwner = (getParameterByName("addOwner") == null ? false : Boolean(getParameterByName("addOwner")));
        userId = (getParameterByName("userId") == null ? 0 : getParameterByName("userId"));
        facilityId = (getParameterByName("facilityId") == null ? 0 : getParameterByName("facilityId"));
        entryUserId = userId;

        // setup the data table
        setDataTable();

        // new vs existing
        if (userId > 0)
        {
            if (patientMaintenance == true)
            {
                // menu
                buildMainMenu("ADL");
                setTitle("Patient Maintenance");
            }
            else
            {
                // menu
                buildMainMenu("Admin");
                setTitle("User Maintenance");
            }

            getUser(userId);

            // this is roles
            getUserAccessList(userId);
            $("#divAccess").show();

            if ($("#patientAccess").val() == "true")
            {
                getPatientFormStatusAPICall(userId)
            }
        
        }
        else
        {
            $("#divAccess").hide();
            if (addOwner == true )
            {
                setTitle("New Owner");
            }
            else
            {
                setTitle("New User");
            }
        }

        // ui dialogs
        buildUIDialogs(accessDialogControl, "Add Access", 700, 500);

    });
    function backToList()
    {
        if (patientMaintenance == true)
        {
            goTo('list.html?patientsOnly=true');
        }
        else
        {
            goTo('list.html');
        }
    }
    function goToPatientForms()
    {
        goTo('../../admin/patient intake/item.html?userId=' + userId);
    }

    $(document).ajaxStop(function ()
    {
        if (assign == true)
        {
            addRole();
        }
 

        // standard events
        setupEvents();
    });

    function validatedAddRole()
    {
 
        $("#addAccessErrorMessage").html('');

        var index = $('#ddlAccessFacility option:selected').val();
        if (index == "-1|N/A")
        {
            $("#addAccessErrorMessage").html('Please select a Facility');
            return false;
        }

        var index = $('#ddlAccessRole option:selected').val();
        if (index == "0")
        {
            $("#addAccessErrorMessage").html('Please select a Role');
            return false;
        }
        
        return true;
    }

    function addRoleFinalStep()
    {
        if (validatedAddRole() == false)
        {
            return;
        }
        else
        {
            var facilityId = getFacilityFromControl("ddlAccessFacility");
            var roleId = $("#ddlAccessRole").val();
            insertUserAccess(userId, roleId, facilityId)
        }
    }

    function addRole()
    {       
        if (facilityId != 0)
        {
            var valueToUse = findFacilityByFacilityId("ddlAccessFacility", facilityId);
            $("#ddlAccessFacility").val(valueToUse);
        }

        if (addOwner == true)
        {
            deleteADDLEntry("ddlAccessRole", "0");
            deleteADDLEntry("ddlAccessRole", cSystemAdmin);
            deleteADDLEntry("ddlAccessRole", cManager);
            deleteADDLEntry("ddlAccessRole", cCaregiver);
            deleteADDLEntry("ddlAccessRole", cPatient);
        }
        if ($("#patientAccess").val() == "false")
        {
            deleteADDLEntry("ddlAccessRole", cPatient);
        }
        if (getLocalStorage("currentRole") != cSystemAdminText)
        {
            deleteADDLEntry("ddlAccessRole", cSystemAdmin);
        }

        $("#addAccessErrorMessage").html('');
        $("#"+accessDialogControl).dialog("open");           
    }

    function setDataTable() 
    {
        $("#btnAddRole").show();
 
        var exportColumns = returnTableColumnsByClass("dt", "exportColumn");

        $("#dt").DataTable({
            "dom": "Blfrtip",
            "bPaginate": false,
            "pageLength": gDataTableDefaultRows,
            "data": [],
            "order": [[ 0, "asc" ]],
            "columns": [
                {
                    "data": 'Facility',
                    "className": "text-align-left"
                },
                {
                    "data": 'Role',
                    "className": "text-align-left"
                },
                {
                    mRender: function (data, type, row) {

                        var action = '';

                            action = action + "<a href='#' onclick='updateUserAccess(" + row.UserId;
                            action = action + ", " + row.RoleId;
                            action = action + ", " + row.FacilityId;
                            
                            action = action + ");'>Remove</a><br>";
                            if (row.RoleId == cPatient)
                            {
                                $("#btnAddRole").hide();
                                $("#patientAccess").val("true");
                                $("#patientForm").show();

                            }
                            else
                            {
                                $("#patientAccess").val("false");
                                $("#patientForm").hide();

                            }

                        return action;

                    },
                    "orderable": false,
                    "searchable": false,
                    "className": "text-align-center"
                }
            ],
            "pagingType": "full_numbers",
            "buttons": [

            ]
        });
        
        $(".dataTables_length").hide();
        $(".dataTables_filter").hide();
        $(".dataTables_info").hide();
        $(".dataTables_paginate paging_full_numbers").hide();

 

    }

    function setupEvents()
    {
        if (addOwner == true)
        {
            $("#ddlAccessRole").mousedown(function()
            {
                return false;
            });

            $("#ddlAccessRole").keydown(function()
            {
                return false;
            });
 
            $("#ddlAccessFacility").mousedown(function()
            {
                return false;
            });

            $("#ddlAccessFacility").keydown(function()
            {
                return false;
            });
        }
        //$(window).on('beforeunload ', function () {
        //    //if (bDirty == true) {
        //    //    bootbox.confirm("You have made changes to this user. Would you like to save them now?", function (result) {
        //    //        if (result == true) {
        //    //            initiatePersonnelUpdate();
        //    //        }
        //    //    });
        //    //}
        //    alert( "Are you sure");
        //});
        window.onbeforeunload = function (e) {
            if (bDirty == true)
            {
                return 'You have unsaved changes. Please save them before leaving this page';
            }
        };

        $("#ddlPosition").change(function () {
            bDirty = true;
        });
        $("#ddlState").change(function () {
            bDirty = true;
        });
        $("input").keypress(function () {
            bDirty = true;
        });
        $("textarea").keypress(function () {
            bDirty = true;
        });
    }

    function getUserAccessList(userId)
    {
        $("#divAccess").show();
        getUserAccessListAPICall(userId);
    }
    function getUserListSuccess(data)
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {
            populateDataTable("dt", data);
        }
    }

    // update user
    function updateUser()
    {

        if (validationPassed() == false)
        {
            return;
        }
        else
        {        // set object
            var updateData =  {"inApiToken": getLocalStorage("APIToken"),
                            "inFirstName": $("#txtFirstName").val(),
                            "inLastName": $("#txtLastName").val(),
                            "inMiddleName": $("#txtMiddleName").val(),
                            "inEmailAddress": $("#txtEmailAddress").val(),
                            "inPhoneNumber": $("#txtPhoneNumber").val(),
                        };
    
            if (userId > 0)
            {
                updateData["inuserId"] = parseInt(userId);
            }

            // stringify
            updateData = JSON.stringify(updateData);

            // send the request
            updateUserAPICall(updateData, userId);
        }

    }

    function updateUserAPICall(updateData, userId) 
    {
        // set url
        var url = ServicePrefix + '/UserMember';

        //set method
        var methodForCall = "";
        if (userId == 0)
        {
            methodForCall = "POST";
        }
        else
        {
            methodForCall = "PUT";
        }

        var settings = {
            dataType: 'json',
            type: methodForCall,
            contentType: 'application/json',
            data:   updateData,
            success: function (data, textStatus, jQxhr) {
                updateUserSuccess(data, textStatus, jQxhr);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }

    function updateUserSuccess(data, textStatus, jQxhr) 
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {           
            userId = data.ReturnCode;
            updateAddress(addressId);
         }
    }

    // update Address
    function updateAddress()
    {
        holdAddressId = 0;
        if (validationPassed() == false)
        {
            return;
        }
        else
        {        // set object
            var updateData = {"inApiToken": getLocalStorage("APIToken")};
            
            if (addressId > 0)
            {
                updateData["inAddressId"] = addressId;
            }

            updateData["inAddress1"] = $("#txtAddress1").val();
            updateData["inAddress2"] = $("#txtAddress2").val();
            updateData["inCity"] = $("#txtCity").val();
            updateData["inStateId"] = parseInt($("#ddlState").val());
            updateData["inCountryId"] = parseInt("1");
            updateData["inZipCode"] = $("#txtZipCode").val();

            // stringify
            updateData = JSON.stringify(updateData);

            // hold this for later
            holdAddressId = addressId;

            // go do the work
            updateAddressAPICall(updateData, addressId);
        }

    }

    function updateAddressSuccess(data, textStatus, jQxhr) 
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {
            // this is what is returned

            addressId = data.ReturnCode;
            // we need to insert it
            if (holdAddressId == 0)
            {
                insertUserAddressAssociation(userId, addressId);
            }
                else 
            {
                userUpdateResponse();
            }

        }
    }  
    
    // insert UserAddress
    function insertUserAddressAssociation(userId, addressId)
    {

        if (validationPassed() == false)
        {
            return;
        }
        else
        {        // set object
            var updateData = JSON.stringify({"inApiToken": getLocalStorage("APIToken"),
                            "inuserId": parseInt(userId), 
                            "inAddressId": parseInt(addressId)});                            
    
            insertUserAddressAssociationAPICall(updateData);
        }

    }
    function insertUserAddressAssociationAPICall(updateData) 
    {
        // set url
        var url = ServicePrefix + '/UserMember/Address';

        //set method
        var methodForCall = "POST";

        var settings = {
            dataType: 'json',
            type: methodForCall,
            contentType: 'application/json',
            data:   updateData,
            success: function (data, textStatus, jQxhr) {
                insertUserAddressAssociationSuccess(data, textStatus, jQxhr);
            },
            error: function (jQxhr, textStatus, errorThrown) {
                genericAjaxError(jQxhr, textStatus, errorThrown);
            }
        };

        $.ajax(url, settings);

    }
    function insertUserAddressAssociationSuccess(data, textStatus, jQxhr) 
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {
            userUpdateResponse();
        }
    }   
    
    function userUpdateResponse()
    {
        var message = "User is ";
            if (entryUserId == 0)
            {
                message = message + " Added. Now let's go setup this User's Access.";
            }
            else
            {
                message = message + " Updated.";

            }
            bootbox.alert(message, function () 
            {   
                bDirty = false;
                if (entryUserId == 0)
                {
                    addRole();
                    entryUserId = userId;
                }
            });

    }
    // get user
    function getUserSuccess(data, textStatus, jQxhr) 
    {

        if (data.response.status != "SUCCESS") {
            bootbox.alert('Process Failed.\n\r\n\r' + data.response.errorMessage[0], function () {});
        } 
        else 
        {
            if (userId > 0)
            {
                console.log(data);
                getUserAddress(userId);
                $("#txtFirstName").val(data.UserInfo.FirstName);    
                $("#txtMiddleName").val(data.UserInfo.MiddleName);    
                $("#txtLastName").val(data.UserInfo.LastName);    
                $("#txtEmailAddress").val(data.UserInfo.EmailAddress);    
                $("#txtPhoneNumber").val(data.UserInfo.PhoneNumber);    
            }
        }
    }

    // get userAddress
    function getUserAddressSuccess(data, textStatus, jQxhr)
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {
            if (data.AddressId > 0)
            {
                getAddress(data.AddressId);
                addressId = data.AddressId;    
            }
        }
    }

    // get Address
    function getAddressSuccess(data, textStatus, jQxhr)
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {
            $("#txtAddress1").val(data.addressRecord.Address1);     
            $("#txtAddress2").val(data.addressRecord.Address2);
            $("#txtCity").val(data.addressRecord.City);
            $("#ddlState").val(data.addressRecord.StateId);
            $("#txtZipCode").val(data.addressRecord.ZipCode);
            $("#txtPhone").val(data.addressRecord.Phone);
                
        }
    }
   
    function insertUserAccess(userId, roleId, facilityId)
    {

         // set object
            var updateData = JSON.stringify({"inApiToken": getLocalStorage("APIToken"),
                            "inuserId": parseInt(userId), 
                            "infacilityId": parseInt(facilityId),
                            "inRoleId": parseInt(roleId)}); 

            insertUserAccessAPICall(updateData);                       

    }

    function insertUserAccessSuccess(data, textStatus, jQxhr) 
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {
            $("#"+accessDialogControl).dialog("close"); 
            bootbox.alert('Access is added.', function () { 
                if (addOwner == true)
                {
                    // send back to facility page
                    goTo('../../admin/facility/item.html?facilityId=' + facilityId);
                }
                else
                {
                    getUserAccessList(userId); 
                }
            });
        }
    }   
    function updateUserAccess(userId, roleId, facilityId)
    {

        if (roleId == cPatient)
        {
            bootbox.alert('Patients can not be removed thru this process, they must be offboarded.', function () {return;});
        }
        else
        {
            // set object
            var updateData = JSON.stringify({"inApiToken": getLocalStorage("APIToken"),
                            "inuserId": parseInt(userId), 
                            "infacilityId": parseInt(facilityId),
                            "inRoleId": parseInt(roleId)}); 
            console.log(updateData);
            updateUserAccessAPICall(updateData);                       
        }
 

    }

    function updateUserAccessSuccess(data, textStatus, jQxhr) 
    {
        if (data.response.status != "SUCCESS") {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {
            bootbox.alert('Access is removed.', function () 
            {
                getUserAccessList(userId);
            });
        }
    }       
    function getPatientFormStatusSuccess(data, textStatus, jQxhr)
    {
        if (data.response.status != "SUCCESS") 
        {
            ADLErrorMessage(data.response.errorMessage[0]);
        } 
        else 
        {      
            $("#divTotalForms").text(data.TotalForms);    
            $("#divTotalSigned").text(data.TotalSigned);   
        }
    }
</script>
