<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700,900' rel='stylesheet' type='text/css'>

    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">

    <!-- Animate.css -->
    <link rel="stylesheet" href="../../css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="../../css/icomoon.css">
    <!-- Simple Line Icons -->
    <link rel="stylesheet" href="../../css/simple-line-icons.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="../../css/bootstrap.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="../../css/style.css">

    <!-- Modernizr JS -->
    <script src="../../js/modernizr-2.6.2.min.js"></script> 
</head>

<body>

    <div id="fh5co-page">
        <header id="fh5co-header" role="banner">
            <div class="container">
                <div class="header-inner" id="menu" >
                    <h1><a href="../../index.html">ADL System</a></h1>
                </div>
            </div>
        </header>
        <div id="fh5co-blog-section">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-md-offset-3  fh5co-heading" style="border:solid 1px silver;border-radius:10px; padding:10px 10px 10px 10px">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input id="email" value="" style="width:100%" />
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" value="" style="width:100%"/>

                        </div>
                        <br />
                        <div style='text-align:center'>
                            <input type="button" value="Login" onclick="login();" style="width:100%" />
                        </div>
                        <hr /> 
                        <div style='text-align:center'>
                            <input type="button" value="Forgot Password" onclick="forgotPassword();" style="width:100%" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- jQuery -->
    <script src="../../js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="../../js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- Bootbox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <!-- Waypoints -->
    <script src="../../js/jquery.waypoints.min.js"></script>
    <!-- BlockUI JS -->
    <script src="../../js/blockUI.js"></script>
    <!-- Config JS -->
    <script src="../../js/config.js"></script>
    <!-- MAIN JS -->
    <script src="../../js/main.js"></script>


    <!--<script type="text/javascript">
        setLocalStorage("APIToken", "value");
        updateTokenTime();
        window.location = "/admin/login/dashboard.html";
    </script>-->
</body>
</html>
<script>
    $(document).ready(function () {

        var input = document.getElementById("password");
        input.addEventListener("keyup", function (event) {
            // Cancel the default action, if needed
            event.preventDefault();
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13)
            {
                login();
            }
        });

        document.getElementById("email").focus();
    });

    function forgotPassword()
    {
        if ($("#email").val() == "")
        {
            bootbox.alert("Please enter an email address", function () {

            });
            return false;
        }

        var inURL = ServicePrefix + "/password"
 
	    $.ajax({
            url: inURL,
            dataType: 'json',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({ "inEmailAddress": $("#email").val() }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                     GeneralErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {

                    bootbox.alert("Password Request sent. You will recieve an email shortly.", function () {
                    });
                  }

            },
            error: function (jqXhr, textStatus, errorThrown) {
                $("#password").val() == "";
                GeneralErrorMessageRtn(errorThrown);
            }
        });

    }
    function login()
    {
        if ($("#email").val() == "")
        {
            bootbox.alert("Please enter an email address", function () {

            });
            return false;
        }

        if ($("#password").val() == "") {
            bootbox.alert("Please enter a password", function () {

            });
            return false;
        }

        var offset = -1 * (new Date()).getTimezoneOffset();
        var inURL = ServicePrefix + "services/PixxGet.asmx/GetMemberID";

        inURL = ServicePrefix + "/login?inEmailAddress=" + $("#email").val() + "&inPassword=" + $("#password").val();
        inURL = inURL + "&inoffset=" + parseInt(offset);
 
        var faStr = "";
        var str = "";

	    $.ajax({
            url: inURL,
            dataType: 'json',
            type: 'get',
            contentType: 'application/json',
           // data: JSON.stringify({ "EmailAddress": emailAdjusted, "PassKey": $("#password").val() }),
            processData: false,
            success: function (data, textStatus, jQxhr) {

                if (data.response.status != "SUCCESS") {
                     $("#password").val() == "";
                     GeneralErrorMessageRtn(data.response.errorMessage[0]);
                }
                else {
                    setLocalStorage("APIToken", data.response.apiToken);                    
                    updateTokenTime();
                    
                    $.each(data.rows, function (index) 
                    {
                        //console.log()
                        // get user info
                        //str = str + '<option value="' + data.report.rows[index].stateAbbr + '">' + data.report.rows[index].stateAbbr + '</option>';
                        
                        setLocalStorage("firstName", data.rows[index].FirstName);
                        setLocalStorage("lastName", data.rows[index].LastName);
                        setLocalStorage("middleName", data.rows[index].MiddleName);

                        setLocalStorage("userId", data.rows[index].UserId);
                        console.log(JSON.stringify(data.rows[index].fa));
                        setLocalStorage("fa", JSON.stringify(data.rows[index].fa));
                        setLocalStorage("facilityAccess", JSON.stringify(data.rows[index].fa));
                        
                        setLocalStorage("currentFacility", "");

                    });


                    

                    


                    window.location = '../../admin/login/dashboard.html?MenuItem=true';
                  }

        },
        error: function (jqXhr, textStatus, errorThrown) {
            $("#password").val() == "";
            GeneralErrorMessageRtn(errorThrown);
        }
    });


}

</script>